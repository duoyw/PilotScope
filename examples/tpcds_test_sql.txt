q0#####select  dt.d_year         ,item.i_brand_id brand_id         ,item.i_brand brand        ,sum(ss_net_profit) sum_agg  from  date_dim dt        ,store_sales       ,item  where dt.d_date_sk = store_sales.ss_sold_date_sk    and store_sales.ss_item_sk = item.i_item_sk    and item.i_manufact_id = 315    and dt.d_moy=12  group by dt.d_year       ,item.i_brand       ,item.i_brand_id  order by dt.d_year          ,sum_agg desc          ,brand_id  limit 100;
q1#####select  dt.d_year         ,item.i_brand_id brand_id         ,item.i_brand brand        ,sum(ss_net_profit) sum_agg  from  date_dim dt        ,store_sales       ,item  where dt.d_date_sk = store_sales.ss_sold_date_sk    and store_sales.ss_item_sk = item.i_item_sk    and item.i_manufact_id = 350    and dt.d_moy=12  group by dt.d_year       ,item.i_brand       ,item.i_brand_id  order by dt.d_year          ,sum_agg desc          ,brand_id  limit 100;
q2#####select  i_item_id,          avg(ss_quantity) agg1,         avg(ss_list_price) agg2,         avg(ss_coupon_amt) agg3,         avg(ss_sales_price) agg4   from store_sales, customer_demographics, date_dim, item, promotion  where ss_sold_date_sk = d_date_sk and        ss_item_sk = i_item_sk and        ss_cdemo_sk = cd_demo_sk and        ss_promo_sk = p_promo_sk and        cd_gender = 'F' and         cd_marital_status = 'D' and        cd_education_status = 'Secondary' and        (p_channel_email = 'N' or p_channel_event = 'N') and        d_year = 2002   group by i_item_id  order by i_item_id  limit 100;
q3#####select  i_item_id,          avg(ss_quantity) agg1,         avg(ss_list_price) agg2,         avg(ss_coupon_amt) agg3,         avg(ss_sales_price) agg4   from store_sales, customer_demographics, date_dim, item, promotion  where ss_sold_date_sk = d_date_sk and        ss_item_sk = i_item_sk and        ss_cdemo_sk = cd_demo_sk and        ss_promo_sk = p_promo_sk and        cd_gender = 'M' and         cd_marital_status = 'S' and        cd_education_status = 'Primary' and        (p_channel_email = 'N' or p_channel_event = 'N') and        d_year = 2002   group by i_item_id  order by i_item_id  limit 100;
q4#####select  s_store_name       ,sum(ss_net_profit)  from store_sales      ,date_dim      ,store,      (select ca_zip      from (       SELECT substr(ca_zip,1,5) ca_zip       FROM customer_address       WHERE substr(ca_zip,1,5) IN (                           '14315','35905','14932','75355','66219','21760',                           '24901','15251','83651','23459','79187',                           '93187','60105','34076','16440','54052',                           '40938','96359','49448','43282','29688',                           '19623','32912','83152','43520','61356',                           '23276','37655','42059','15234','82371',                           '40720','83403','77329','35096','68216',                           '24849','29860','62712','20607','69460',                           '27068','59885','95101','52836','52462',                           '49849','69053','85239','67947','57233',                           '44804','28507','38173','73521','41914',                           '69946','18172','37132','73287','42244',                           '24731','46257','62286','31003','16491',                           '34907','72794','21441','50196','22467',                           '12200','78655','97913','25345','14822',                           '89682','54438','71650','26452','40500',                           '84691','62316','67813','49256','67168',                           '47186','20639','55656','60167','79296',                           '10860','61866','11737','20369','21995',                           '26778','26751','53123','56352','16308',                           '46215','80041','88811','63614','12991',                           '46557','26792','77051','77457','10360',                           '18391','39759','60916','91010','20411',                           '80462','57791','80153','32763','40474',                           '70699','45808','13643','58486','56153',                           '12589','24533','83895','23362','77942',                           '93628','18281','43262','58617','92327',                           '68386','29188','43181','17182','37361',                           '99004','78840','87194','98005','39966',                           '73749','63320','13699','76778','71736',                           '51243','53927','50873','44602','75448',                           '49558','32847','11556','69446','41709',                           '71771','58014','79852','16983','57937',                           '77620','89031','10452','84942','94637',                           '57244','26204','42925','46668','21388',                           '46245','71780','41434','86833','44369',                           '18373','30789','43400','52493','26684',                           '84950','12747','22372','59552','63574',                           '55714','42788','18630','45558','99060',                           '30821','66174','76791','67157','89599',                           '95154','12777','96634','80943','19368',                           '58145','33141','75769','65321','62881',                           '84167','59593','66942','21161','98939',                           '51328','64303','56380','50104','99941',                           '94006','42802','31271','57904','10987',                           '12557','58333','53087','56969','34009',                           '98891','50989','64688','48896','23779',                           '42803','53659','19648','18666','14778',                           '31371','17802','36559','73288','22266',                           '92126','71336','54637','11649','45455',                           '24360','17951','10713','12203','17859',                           '49064','61495','83223','54167','60155',                           '54876','60474','98166','83866','77251',                           '32332','14665','51629','55358','22576',                           '28683','98907','91555','37825','68779',                           '60012','15480','99280','10765','14980',                           '53036','10276','90595','24603','42162',                           '96886','84751','64090','39653','90971',                           '64807','77707','74445','67601','42884',                           '20323','35961','83821','79360','86253',                           '56780','99665','63925','44658','54965',                           '60355','61035','48696','67492','42742',                           '67413','62583','10413','37862','66009',                           '99263','16171','14854','23229','12645',                           '20943','27085','77787','22830','16575',                           '13510','26922','69123','33618','89405',                           '37548','89575','62239','49208','69428',                           '19154','68392','59359','48106','10965',                           '26577','65767','13815','58684','10101',                           '33837','18130','69719','77653','61378',                           '57280','72607','26254','39383','37114',                           '46536','31303','19774','90240','15700',                           '98758','31286','10079','89794','20351',                           '66438','30033','59116','23217','10957',                           '55363','55013','31232','28765','53155',                           '93789','95207','24598','60018','90900',                           '24217','51102','70669','50372','33563',                           '68872','66432','43558','33759','20254',                           '21145','43839','39002','78843','93372',                           '42127','20302','84632','87580')      intersect       select ca_zip       from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt             FROM customer_address, customer             WHERE ca_address_sk = c_current_addr_sk and                   c_preferred_cust_flag='Y'             group by ca_zip             having count(*) > 10)A1)A2) V1  where ss_store_sk = s_store_sk   and ss_sold_date_sk = d_date_sk   and d_qoy = 2 and d_year = 2002   and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))  group by s_store_name  order by s_store_name  limit 100;
q5#####select  s_store_name       ,sum(ss_net_profit)  from store_sales      ,date_dim      ,store,      (select ca_zip      from (       SELECT substr(ca_zip,1,5) ca_zip       FROM customer_address       WHERE substr(ca_zip,1,5) IN (                           '98350','70586','36052','37362','80654','62224',                           '88974','81363','98638','70164','49081',                           '17269','23424','76134','36375','10990',                           '47175','45004','86354','73956','60364',                           '92853','25103','54747','38085','81145',                           '34598','59202','41152','11682','98486',                           '41976','87955','93335','53205','43966',                           '49073','51198','58134','11615','47348',                           '25520','29339','30366','44544','58728',                           '89797','76370','24996','72438','41966',                           '87375','36582','64776','23979','97432',                           '67507','45556','89885','87656','38520',                           '95972','61495','64571','31496','23628',                           '64109','14367','52050','72303','78596',                           '82468','31003','64379','21633','37104',                           '42239','25945','87627','79731','38453',                           '72648','79156','79377','73910','87369',                           '57224','23839','64520','77850','25592',                           '53458','53310','89437','10004','24868',                           '58145','57830','67195','41429','65814',                           '51630','64788','90241','14834','38840',                           '38259','45539','37580','98153','40170',                           '52453','97543','91083','58244','34024',                           '26085','84114','47718','36674','34290',                           '44837','54334','36389','83731','52695',                           '90392','57599','28350','72584','19920',                           '95249','54423','41581','27086','99321',                           '33755','80833','96684','11178','29370',                           '14924','23886','72395','79978','30710',                           '89240','13834','70024','69999','84302',                           '75341','37524','73923','95581','14513',                           '21277','15786','20659','29317','99485',                           '84793','52465','60641','17221','92947',                           '18672','83518','14816','17184','98125',                           '74341','52999','25320','47237','93898',                           '62382','66273','49961','74094','16540',                           '41595','19639','86038','17787','14936',                           '76113','39792','22540','16532','90652',                           '24987','50238','33617','21912','32208',                           '88148','77558','19245','66064','74878',                           '35652','10694','66193','14734','11627',                           '22159','26254','10166','41584','45602',                           '51371','61867','55005','74664','75406',                           '66480','77815','40671','96189','92028',                           '28210','53796','69823','24358','91749',                           '32475','95834','64354','55683','43781',                           '69889','43663','50231','54594','57465',                           '56669','55863','47889','40684','94943',                           '28277','11136','15276','36849','74481',                           '75587','88060','94618','72363','29309',                           '16315','19769','83919','91660','14377',                           '50491','95167','35489','33375','36309',                           '63990','28447','49254','36735','64935',                           '73545','86813','51684','76052','54573',                           '86829','20798','43277','37471','54404',                           '39408','48379','59736','34725','66721',                           '19356','54414','59715','61491','90781',                           '76979','55913','59470','72788','21518',                           '37994','62237','28213','40302','16480',                           '74375','35465','56736','37308','22717',                           '33707','81024','94814','25919','14101',                           '63151','46498','22835','75068','31319',                           '57000','82122','37331','22402','30938',                           '16212','31079','22122','55745','68345',                           '20073','71105','32684','73489','87270',                           '19071','32716','24733','21155','96160',                           '71638','17104','62172','47399','70072',                           '60416','35555','33673','56089','27424',                           '66382','15071','65604','55945','13254',                           '38016','26818','71283','48139','70985',                           '26861','93483','47023','60944','72375',                           '34263','85304','19423','20097','33667',                           '69268','20443','32440','16308','80064',                           '66814','40668','12444','29613','90591',                           '68966','38791','59461','43408','44252',                           '21123','42749','15055','28278','77530',                           '42387','77524','35681','57005','79718',                           '81951','92546','65302','69281','79838',                           '66494','21560','40640','76161','55153',                           '17464','15528','76498','30754')      intersect       select ca_zip       from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt             FROM customer_address, customer             WHERE ca_address_sk = c_current_addr_sk and                   c_preferred_cust_flag='Y'             group by ca_zip             having count(*) > 10)A1)A2) V1  where ss_store_sk = s_store_sk   and ss_sold_date_sk = d_date_sk   and d_qoy = 2 and d_year = 1998   and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))  group by s_store_name  order by s_store_name  limit 100;
q6#####select case when (select count(*)                    from store_sales                    where ss_quantity between 1 and 20) > 35979             then (select avg(ss_ext_list_price)                    from store_sales                    where ss_quantity between 1 and 20)              else (select avg(ss_net_paid_inc_tax)                   from store_sales                   where ss_quantity between 1 and 20) end bucket1 ,        case when (select count(*)                   from store_sales                   where ss_quantity between 21 and 40) > 116053             then (select avg(ss_ext_list_price)                   from store_sales                   where ss_quantity between 21 and 40)              else (select avg(ss_net_paid_inc_tax)                   from store_sales                   where ss_quantity between 21 and 40) end bucket2,        case when (select count(*)                   from store_sales                   where ss_quantity between 41 and 60) > 383465             then (select avg(ss_ext_list_price)                   from store_sales                   where ss_quantity between 41 and 60)             else (select avg(ss_net_paid_inc_tax)                   from store_sales                   where ss_quantity between 41 and 60) end bucket3,        case when (select count(*)                   from store_sales                   where ss_quantity between 61 and 80) > 5356             then (select avg(ss_ext_list_price)                   from store_sales                   where ss_quantity between 61 and 80)             else (select avg(ss_net_paid_inc_tax)                   from store_sales                   where ss_quantity between 61 and 80) end bucket4,        case when (select count(*)                   from store_sales                   where ss_quantity between 81 and 100) > 329392             then (select avg(ss_ext_list_price)                   from store_sales                   where ss_quantity between 81 and 100)             else (select avg(ss_net_paid_inc_tax)                   from store_sales                   where ss_quantity between 81 and 100) end bucket5 from reason where r_reason_sk = 1 ;
q7#####select case when (select count(*)                    from store_sales                    where ss_quantity between 1 and 20) > 178242             then (select avg(ss_ext_discount_amt)                    from store_sales                    where ss_quantity between 1 and 20)              else (select avg(ss_net_paid)                   from store_sales                   where ss_quantity between 1 and 20) end bucket1 ,        case when (select count(*)                   from store_sales                   where ss_quantity between 21 and 40) > 4009             then (select avg(ss_ext_discount_amt)                   from store_sales                   where ss_quantity between 21 and 40)              else (select avg(ss_net_paid)                   from store_sales                   where ss_quantity between 21 and 40) end bucket2,        case when (select count(*)                   from store_sales                   where ss_quantity between 41 and 60) > 123403             then (select avg(ss_ext_discount_amt)                   from store_sales                   where ss_quantity between 41 and 60)             else (select avg(ss_net_paid)                   from store_sales                   where ss_quantity between 41 and 60) end bucket3,        case when (select count(*)                   from store_sales                   where ss_quantity between 61 and 80) > 34322             then (select avg(ss_ext_discount_amt)                   from store_sales                   where ss_quantity between 61 and 80)             else (select avg(ss_net_paid)                   from store_sales                   where ss_quantity between 61 and 80) end bucket4,        case when (select count(*)                   from store_sales                   where ss_quantity between 81 and 100) > 127633             then (select avg(ss_ext_discount_amt)                   from store_sales                   where ss_quantity between 81 and 100)             else (select avg(ss_net_paid)                   from store_sales                   where ss_quantity between 81 and 100) end bucket5 from reason where r_reason_sk = 1 ;
q8#####select     cd_gender,   cd_marital_status,   cd_education_status,   count(*) cnt1,   cd_purchase_estimate,   count(*) cnt2,   cd_credit_rating,   count(*) cnt3,   cd_dep_count,   count(*) cnt4,   cd_dep_employed_count,   count(*) cnt5,   cd_dep_college_count,   count(*) cnt6  from   customer c,customer_address ca,customer_demographics  where   c.c_current_addr_sk = ca.ca_address_sk and   ca_county in ('Hickory County','Clear Creek County','Hempstead County','Asotin County','Lake County') and   cd_demo_sk = c.c_current_cdemo_sk and    exists (select *           from store_sales,date_dim           where c.c_customer_sk = ss_customer_sk and                 ss_sold_date_sk = d_date_sk and                 d_year = 2001 and                 d_moy between 4 and 4+3) and    (exists (select *             from web_sales,date_dim             where c.c_customer_sk = ws_bill_customer_sk and                   ws_sold_date_sk = d_date_sk and                   d_year = 2001 and                   d_moy between 4 ANd 4+3) or      exists (select *              from catalog_sales,date_dim             where c.c_customer_sk = cs_ship_customer_sk and                   cs_sold_date_sk = d_date_sk and                   d_year = 2001 and                   d_moy between 4 and 4+3))  group by cd_gender,           cd_marital_status,           cd_education_status,           cd_purchase_estimate,           cd_credit_rating,           cd_dep_count,           cd_dep_employed_count,           cd_dep_college_count  order by cd_gender,           cd_marital_status,           cd_education_status,           cd_purchase_estimate,           cd_credit_rating,           cd_dep_count,           cd_dep_employed_count,           cd_dep_college_count limit 100;
q9#####select     cd_gender,   cd_marital_status,   cd_education_status,   count(*) cnt1,   cd_purchase_estimate,   count(*) cnt2,   cd_credit_rating,   count(*) cnt3,   cd_dep_count,   count(*) cnt4,   cd_dep_employed_count,   count(*) cnt5,   cd_dep_college_count,   count(*) cnt6  from   customer c,customer_address ca,customer_demographics  where   c.c_current_addr_sk = ca.ca_address_sk and   ca_county in ('Lancaster County','Cheshire County','Alcorn County','Henry County','Clarke County') and   cd_demo_sk = c.c_current_cdemo_sk and    exists (select *           from store_sales,date_dim           where c.c_customer_sk = ss_customer_sk and                 ss_sold_date_sk = d_date_sk and                 d_year = 2000 and                 d_moy between 2 and 2+3) and    (exists (select *             from web_sales,date_dim             where c.c_customer_sk = ws_bill_customer_sk and                   ws_sold_date_sk = d_date_sk and                   d_year = 2000 and                   d_moy between 2 ANd 2+3) or      exists (select *              from catalog_sales,date_dim             where c.c_customer_sk = cs_ship_customer_sk and                   cs_sold_date_sk = d_date_sk and                   d_year = 2000 and                   d_moy between 2 and 2+3))  group by cd_gender,           cd_marital_status,           cd_education_status,           cd_purchase_estimate,           cd_credit_rating,           cd_dep_count,           cd_dep_employed_count,           cd_dep_college_count  order by cd_gender,           cd_marital_status,           cd_education_status,           cd_purchase_estimate,           cd_credit_rating,           cd_dep_count,           cd_dep_employed_count,           cd_dep_college_count limit 100;
q10#####select  i_item_id       ,i_item_desc        ,i_category        ,i_class        ,i_current_price       ,sum(ws_ext_sales_price) as itemrevenue        ,sum(ws_ext_sales_price)*100/sum(sum(ws_ext_sales_price)) over           (partition by i_class) as revenueratio from	 	web_sales     	,item      	,date_dim where  	ws_item_sk = i_item_sk    	and i_category in ('Home', 'Sports', 'Shoes')   	and ws_sold_date_sk = d_date_sk 	and d_date between cast('2000-02-16' as date)  				and (cast('2000-02-16' as date) + interval 30 days) group by  	i_item_id         ,i_item_desc          ,i_category         ,i_class         ,i_current_price order by  	i_category         ,i_class         ,i_item_id         ,i_item_desc         ,revenueratio limit 100;
q11#####select  i_item_id       ,i_item_desc        ,i_category        ,i_class        ,i_current_price       ,sum(ws_ext_sales_price) as itemrevenue        ,sum(ws_ext_sales_price)*100/sum(sum(ws_ext_sales_price)) over           (partition by i_class) as revenueratio from	 	web_sales     	,item      	,date_dim where  	ws_item_sk = i_item_sk    	and i_category in ('Electronics', 'Music', 'Sports')   	and ws_sold_date_sk = d_date_sk 	and d_date between cast('2001-04-03' as date)  				and (cast('2001-04-03' as date) + interval 30 days) group by  	i_item_id         ,i_item_desc          ,i_category         ,i_class         ,i_current_price order by  	i_category         ,i_class         ,i_item_id         ,i_item_desc         ,revenueratio limit 100;
q12#####select avg(ss_quantity)        ,avg(ss_ext_sales_price)        ,avg(ss_ext_wholesale_cost)        ,sum(ss_ext_wholesale_cost)  from store_sales      ,store      ,customer_demographics      ,household_demographics      ,customer_address      ,date_dim  where s_store_sk = ss_store_sk  and  ss_sold_date_sk = d_date_sk and d_year = 2001  and((ss_hdemo_sk=hd_demo_sk   and cd_demo_sk = ss_cdemo_sk   and cd_marital_status = 'S'   and cd_education_status = 'Unknown'   and ss_sales_price between 100.00 and 150.00   and hd_dep_count = 3         )or      (ss_hdemo_sk=hd_demo_sk   and cd_demo_sk = ss_cdemo_sk   and cd_marital_status = 'M'   and cd_education_status = 'Advanced Degree'   and ss_sales_price between 50.00 and 100.00      and hd_dep_count = 1      ) or       (ss_hdemo_sk=hd_demo_sk   and cd_demo_sk = ss_cdemo_sk   and cd_marital_status = 'W'   and cd_education_status = 'College'   and ss_sales_price between 150.00 and 200.00    and hd_dep_count = 1        ))  and((ss_addr_sk = ca_address_sk   and ca_country = 'United States'   and ca_state in ('MT', 'VA', 'MI')   and ss_net_profit between 100 and 200        ) or      (ss_addr_sk = ca_address_sk   and ca_country = 'United States'   and ca_state in ('MN', 'AL', 'SD')   and ss_net_profit between 150 and 300        ) or      (ss_addr_sk = ca_address_sk   and ca_country = 'United States'   and ca_state in ('PA', 'GA', 'OK')   and ss_net_profit between 50 and 250        )) ;
q13#####select avg(ss_quantity)        ,avg(ss_ext_sales_price)        ,avg(ss_ext_wholesale_cost)        ,sum(ss_ext_wholesale_cost)  from store_sales      ,store      ,customer_demographics      ,household_demographics      ,customer_address      ,date_dim  where s_store_sk = ss_store_sk  and  ss_sold_date_sk = d_date_sk and d_year = 2001  and((ss_hdemo_sk=hd_demo_sk   and cd_demo_sk = ss_cdemo_sk   and cd_marital_status = 'S'   and cd_education_status = 'College'   and ss_sales_price between 100.00 and 150.00   and hd_dep_count = 3         )or      (ss_hdemo_sk=hd_demo_sk   and cd_demo_sk = ss_cdemo_sk   and cd_marital_status = 'W'   and cd_education_status = 'Advanced Degree'   and ss_sales_price between 50.00 and 100.00      and hd_dep_count = 1      ) or       (ss_hdemo_sk=hd_demo_sk   and cd_demo_sk = ss_cdemo_sk   and cd_marital_status = 'D'   and cd_education_status = 'Secondary'   and ss_sales_price between 150.00 and 200.00    and hd_dep_count = 1        ))  and((ss_addr_sk = ca_address_sk   and ca_country = 'United States'   and ca_state in ('MO', 'TX', 'WA')   and ss_net_profit between 100 and 200        ) or      (ss_addr_sk = ca_address_sk   and ca_country = 'United States'   and ca_state in ('WI', 'GA', 'WV')   and ss_net_profit between 150 and 300        ) or      (ss_addr_sk = ca_address_sk   and ca_country = 'United States'   and ca_state in ('MI', 'VA', 'ND')   and ss_net_profit between 50 and 250        )) ;
q14#####select      count(distinct cs_order_number) as ordercount   ,sum(cs_ext_ship_cost) as totalshippingcost   ,sum(cs_net_profit) as totalnetprofit from    catalog_sales cs1   ,date_dim   ,customer_address   ,call_center where     d_date between '2001-2-01' and             (cast('2001-2-01' as date) + interval 60 days) and cs1.cs_ship_date_sk = d_date_sk and cs1.cs_ship_addr_sk = ca_address_sk and ca_state = 'AR' and cs1.cs_call_center_sk = cc_call_center_sk and cc_county in ('Williamson County','Walker County','Ziebach County','Williamson County',                   'Ziebach County' ) and exists (select *             from catalog_sales cs2             where cs1.cs_order_number = cs2.cs_order_number               and cs1.cs_warehouse_sk <> cs2.cs_warehouse_sk) and not exists(select *                from catalog_returns cr1                where cs1.cs_order_number = cr1.cr_order_number) order by count(distinct cs_order_number) limit 100;
q15#####select      count(distinct cs_order_number) as ordercount   ,sum(cs_ext_ship_cost) as totalshippingcost   ,sum(cs_net_profit) as totalnetprofit from    catalog_sales cs1   ,date_dim   ,customer_address   ,call_center where     d_date between '2002-3-01' and             (cast('2002-3-01' as date) + interval 60 days) and cs1.cs_ship_date_sk = d_date_sk and cs1.cs_ship_addr_sk = ca_address_sk and ca_state = 'CA' and cs1.cs_call_center_sk = cc_call_center_sk and cc_county in ('Williamson County','Walker County','Ziebach County','Williamson County',                   'Ziebach County' ) and exists (select *             from catalog_sales cs2             where cs1.cs_order_number = cs2.cs_order_number               and cs1.cs_warehouse_sk <> cs2.cs_warehouse_sk) and not exists(select *                from catalog_returns cr1                where cs1.cs_order_number = cr1.cr_order_number) order by count(distinct cs_order_number) limit 100;
q16#####select  i_item_id,         ca_country,         ca_state,          ca_county,         avg( cast(cs_quantity as decimal(12,2))) agg1,         avg( cast(cs_list_price as decimal(12,2))) agg2,         avg( cast(cs_coupon_amt as decimal(12,2))) agg3,         avg( cast(cs_sales_price as decimal(12,2))) agg4,         avg( cast(cs_net_profit as decimal(12,2))) agg5,         avg( cast(c_birth_year as decimal(12,2))) agg6,         avg( cast(cd1.cd_dep_count as decimal(12,2))) agg7  from catalog_sales, customer_demographics cd1,        customer_demographics cd2, customer, customer_address, date_dim, item  where cs_sold_date_sk = d_date_sk and        cs_item_sk = i_item_sk and        cs_bill_cdemo_sk = cd1.cd_demo_sk and        cs_bill_customer_sk = c_customer_sk and        cd1.cd_gender = 'F' and         cd1.cd_education_status = 'Advanced Degree' and        c_current_cdemo_sk = cd2.cd_demo_sk and        c_current_addr_sk = ca_address_sk and        c_birth_month in (8,4,3,12,2,5) and        d_year = 2000 and        ca_state in ('NE','GA','CA'                    ,'AZ','IL','PA','TX')  group by rollup (i_item_id, ca_country, ca_state, ca_county)  order by ca_country,         ca_state,          ca_county, 	i_item_id  limit 100;
q17#####select  i_item_id,         ca_country,         ca_state,          ca_county,         avg( cast(cs_quantity as decimal(12,2))) agg1,         avg( cast(cs_list_price as decimal(12,2))) agg2,         avg( cast(cs_coupon_amt as decimal(12,2))) agg3,         avg( cast(cs_sales_price as decimal(12,2))) agg4,         avg( cast(cs_net_profit as decimal(12,2))) agg5,         avg( cast(c_birth_year as decimal(12,2))) agg6,         avg( cast(cd1.cd_dep_count as decimal(12,2))) agg7  from catalog_sales, customer_demographics cd1,        customer_demographics cd2, customer, customer_address, date_dim, item  where cs_sold_date_sk = d_date_sk and        cs_item_sk = i_item_sk and        cs_bill_cdemo_sk = cd1.cd_demo_sk and        cs_bill_customer_sk = c_customer_sk and        cd1.cd_gender = 'F' and         cd1.cd_education_status = 'Primary' and        c_current_cdemo_sk = cd2.cd_demo_sk and        c_current_addr_sk = ca_address_sk and        c_birth_month in (7,9,1,5,4,6) and        d_year = 2000 and        ca_state in ('WA','TN','SD'                    ,'VA','IA','AK','SC')  group by rollup (i_item_id, ca_country, ca_state, ca_county)  order by ca_country,         ca_state,          ca_county, 	i_item_id  limit 100;
q18#####select  i_brand_id brand_id, i_brand brand, i_manufact_id, i_manufact,  	sum(ss_ext_sales_price) ext_price  from date_dim, store_sales, item,customer,customer_address,store  where d_date_sk = ss_sold_date_sk    and ss_item_sk = i_item_sk    and i_manager_id=28    and d_moy=11    and d_year=2000    and ss_customer_sk = c_customer_sk     and c_current_addr_sk = ca_address_sk    and substr(ca_zip,1,5) <> substr(s_zip,1,5)     and ss_store_sk = s_store_sk   group by i_brand       ,i_brand_id       ,i_manufact_id       ,i_manufact  order by ext_price desc          ,i_brand          ,i_brand_id          ,i_manufact_id          ,i_manufact limit 100 ;
q19#####select  i_brand_id brand_id, i_brand brand, i_manufact_id, i_manufact,  	sum(ss_ext_sales_price) ext_price  from date_dim, store_sales, item,customer,customer_address,store  where d_date_sk = ss_sold_date_sk    and ss_item_sk = i_item_sk    and i_manager_id=65    and d_moy=11    and d_year=2001    and ss_customer_sk = c_customer_sk     and c_current_addr_sk = ca_address_sk    and substr(ca_zip,1,5) <> substr(s_zip,1,5)     and ss_store_sk = s_store_sk   group by i_brand       ,i_brand_id       ,i_manufact_id       ,i_manufact  order by ext_price desc          ,i_brand          ,i_brand_id          ,i_manufact_id          ,i_manufact limit 100 ;
q20#####select  i_item_id        ,i_item_desc         ,i_category         ,i_class         ,i_current_price        ,sum(cs_ext_sales_price) as itemrevenue         ,sum(cs_ext_sales_price)*100/sum(sum(cs_ext_sales_price)) over            (partition by i_class) as revenueratio  from	catalog_sales      ,item       ,date_dim  where cs_item_sk = i_item_sk     and i_category in ('Home', 'Sports', 'Shoes')    and cs_sold_date_sk = d_date_sk  and d_date between cast('2000-02-16' as date)   				and (cast('2000-02-16' as date) + interval 30 days)  group by i_item_id          ,i_item_desc           ,i_category          ,i_class          ,i_current_price  order by i_category          ,i_class          ,i_item_id          ,i_item_desc          ,revenueratio limit 100;
q21#####select  i_item_id        ,i_item_desc         ,i_category         ,i_class         ,i_current_price        ,sum(cs_ext_sales_price) as itemrevenue         ,sum(cs_ext_sales_price)*100/sum(sum(cs_ext_sales_price)) over            (partition by i_class) as revenueratio  from	catalog_sales      ,item       ,date_dim  where cs_item_sk = i_item_sk     and i_category in ('Electronics', 'Music', 'Sports')    and cs_sold_date_sk = d_date_sk  and d_date between cast('2001-04-03' as date)   				and (cast('2001-04-03' as date) + interval 30 days)  group by i_item_id          ,i_item_desc           ,i_category          ,i_class          ,i_current_price  order by i_category          ,i_class          ,i_item_id          ,i_item_desc          ,revenueratio limit 100;
q22#####select  *  from(select w_warehouse_name             ,i_item_id             ,sum(case when (cast(d_date as date) < cast ('2001-05-02' as date)) 	                then inv_quantity_on_hand                        else 0 end) as inv_before             ,sum(case when (cast(d_date as date) >= cast ('2001-05-02' as date))                       then inv_quantity_on_hand                        else 0 end) as inv_after    from inventory        ,warehouse        ,item        ,date_dim    where i_current_price between 0.99 and 1.49      and i_item_sk          = inv_item_sk      and inv_warehouse_sk   = w_warehouse_sk      and inv_date_sk    = d_date_sk      and d_date between (cast ('2001-05-02' as date) - interval 30 days)                     and (cast ('2001-05-02' as date) + interval 30 days)    group by w_warehouse_name, i_item_id) x  where (case when inv_before > 0               then inv_after / inv_before               else null              end) between 2.0/3.0 and 3.0/2.0  order by w_warehouse_name          ,i_item_id  limit 100;
q23#####select  *  from(select w_warehouse_name             ,i_item_id             ,sum(case when (cast(d_date as date) < cast ('2002-03-03' as date)) 	                then inv_quantity_on_hand                        else 0 end) as inv_before             ,sum(case when (cast(d_date as date) >= cast ('2002-03-03' as date))                       then inv_quantity_on_hand                        else 0 end) as inv_after    from inventory        ,warehouse        ,item        ,date_dim    where i_current_price between 0.99 and 1.49      and i_item_sk          = inv_item_sk      and inv_warehouse_sk   = w_warehouse_sk      and inv_date_sk    = d_date_sk      and d_date between (cast ('2002-03-03' as date) - interval 30 days)                     and (cast ('2002-03-03' as date) + interval 30 days)    group by w_warehouse_name, i_item_id) x  where (case when inv_before > 0               then inv_after / inv_before               else null              end) between 2.0/3.0 and 3.0/2.0  order by w_warehouse_name          ,i_item_id  limit 100;
q24#####with ssales as (select c_last_name       ,c_first_name       ,s_store_name       ,ca_state       ,s_state       ,i_color       ,i_current_price       ,i_manager_id       ,i_units       ,i_size       ,sum(ss_sales_price) netpaid from store_sales     ,store_returns     ,store     ,item     ,customer     ,customer_address where ss_ticket_number = sr_ticket_number   and ss_item_sk = sr_item_sk   and ss_customer_sk = c_customer_sk   and ss_item_sk = i_item_sk   and ss_store_sk = s_store_sk   and c_current_addr_sk = ca_address_sk   and c_birth_country <> upper(ca_country)   and s_zip = ca_zip   and s_market_id = 5 group by c_last_name         ,c_first_name         ,s_store_name         ,ca_state         ,s_state         ,i_color         ,i_current_price         ,i_manager_id         ,i_units         ,i_size) select c_last_name       ,c_first_name       ,s_store_name       ,sum(netpaid) paid from ssales where i_color = 'bisque' group by c_last_name         ,c_first_name         ,s_store_name having sum(netpaid) > (select 0.05*avg(netpaid)                            from ssales) order by c_last_name         ,c_first_name         ,s_store_name ;
q25#####with ssales as (select c_last_name       ,c_first_name       ,s_store_name       ,ca_state       ,s_state       ,i_color       ,i_current_price       ,i_manager_id       ,i_units       ,i_size       ,sum(ss_ext_sales_price) netpaid from store_sales     ,store_returns     ,store     ,item     ,customer     ,customer_address where ss_ticket_number = sr_ticket_number   and ss_item_sk = sr_item_sk   and ss_customer_sk = c_customer_sk   and ss_item_sk = i_item_sk   and ss_store_sk = s_store_sk   and c_current_addr_sk = ca_address_sk   and c_birth_country <> upper(ca_country)   and s_zip = ca_zip   and s_market_id = 8 group by c_last_name         ,c_first_name         ,s_store_name         ,ca_state         ,s_state         ,i_color         ,i_current_price         ,i_manager_id         ,i_units         ,i_size) select c_last_name       ,c_first_name       ,s_store_name       ,sum(netpaid) paid from ssales where i_color = 'medium' group by c_last_name         ,c_first_name         ,s_store_name having sum(netpaid) > (select 0.05*avg(netpaid)                            from ssales) order by c_last_name         ,c_first_name         ,s_store_name ;
q26#####select  i_item_id,          avg(cs_quantity) agg1,         avg(cs_list_price) agg2,         avg(cs_coupon_amt) agg3,         avg(cs_sales_price) agg4   from catalog_sales, customer_demographics, date_dim, item, promotion  where cs_sold_date_sk = d_date_sk and        cs_item_sk = i_item_sk and        cs_bill_cdemo_sk = cd_demo_sk and        cs_promo_sk = p_promo_sk and        cd_gender = 'F' and         cd_marital_status = 'D' and        cd_education_status = 'Secondary' and        (p_channel_email = 'N' or p_channel_event = 'N') and        d_year = 2002   group by i_item_id  order by i_item_id  limit 100;
q27#####select  i_item_id,          avg(cs_quantity) agg1,         avg(cs_list_price) agg2,         avg(cs_coupon_amt) agg3,         avg(cs_sales_price) agg4   from catalog_sales, customer_demographics, date_dim, item, promotion  where cs_sold_date_sk = d_date_sk and        cs_item_sk = i_item_sk and        cs_bill_cdemo_sk = cd_demo_sk and        cs_promo_sk = p_promo_sk and        cd_gender = 'M' and         cd_marital_status = 'S' and        cd_education_status = 'Primary' and        (p_channel_email = 'N' or p_channel_event = 'N') and        d_year = 2002   group by i_item_id  order by i_item_id  limit 100;
q28#####select  i_item_id,         s_state, grouping(s_state) g_state,         avg(ss_quantity) agg1,         avg(ss_list_price) agg2,         avg(ss_coupon_amt) agg3,         avg(ss_sales_price) agg4  from store_sales, customer_demographics, date_dim, store, item  where ss_sold_date_sk = d_date_sk and        ss_item_sk = i_item_sk and        ss_store_sk = s_store_sk and        ss_cdemo_sk = cd_demo_sk and        cd_gender = 'M' and        cd_marital_status = 'D' and        cd_education_status = 'Unknown' and        d_year = 1998 and        s_state in ('SD','AL', 'TN', 'TN', 'SD', 'SD')  group by rollup (i_item_id, s_state)  order by i_item_id          ,s_state  limit 100;
q29#####select  i_item_id,         s_state, grouping(s_state) g_state,         avg(ss_quantity) agg1,         avg(ss_list_price) agg2,         avg(ss_coupon_amt) agg3,         avg(ss_sales_price) agg4  from store_sales, customer_demographics, date_dim, store, item  where ss_sold_date_sk = d_date_sk and        ss_item_sk = i_item_sk and        ss_store_sk = s_store_sk and        ss_cdemo_sk = cd_demo_sk and        cd_gender = 'M' and        cd_marital_status = 'S' and        cd_education_status = 'Advanced Degree' and        d_year = 2001 and        s_state in ('AL','TN', 'SD', 'TN', 'SD', 'SD')  group by rollup (i_item_id, s_state)  order by i_item_id          ,s_state  limit 100;
q30#####select  * from (select avg(ss_list_price) B1_LP             ,count(ss_list_price) B1_CNT             ,count(distinct ss_list_price) B1_CNTD       from store_sales       where ss_quantity between 0 and 5         and (ss_list_price between 87 and 87+10               or ss_coupon_amt between 4024 and 4024+1000              or ss_wholesale_cost between 35 and 35+20)) B1,      (select avg(ss_list_price) B2_LP             ,count(ss_list_price) B2_CNT             ,count(distinct ss_list_price) B2_CNTD       from store_sales       where ss_quantity between 6 and 10         and (ss_list_price between 181 and 181+10           or ss_coupon_amt between 16785 and 16785+1000           or ss_wholesale_cost between 26 and 26+20)) B2,      (select avg(ss_list_price) B3_LP             ,count(ss_list_price) B3_CNT             ,count(distinct ss_list_price) B3_CNTD       from store_sales       where ss_quantity between 11 and 15         and (ss_list_price between 0 and 0+10           or ss_coupon_amt between 17729 and 17729+1000           or ss_wholesale_cost between 29 and 29+20)) B3,      (select avg(ss_list_price) B4_LP             ,count(ss_list_price) B4_CNT             ,count(distinct ss_list_price) B4_CNTD       from store_sales       where ss_quantity between 16 and 20         and (ss_list_price between 143 and 143+10           or ss_coupon_amt between 16894 and 16894+1000           or ss_wholesale_cost between 5 and 5+20)) B4,      (select avg(ss_list_price) B5_LP             ,count(ss_list_price) B5_CNT             ,count(distinct ss_list_price) B5_CNTD       from store_sales       where ss_quantity between 21 and 25         and (ss_list_price between 168 and 168+10           or ss_coupon_amt between 13924 and 13924+1000           or ss_wholesale_cost between 30 and 30+20)) B5,      (select avg(ss_list_price) B6_LP             ,count(ss_list_price) B6_CNT             ,count(distinct ss_list_price) B6_CNTD       from store_sales       where ss_quantity between 26 and 30         and (ss_list_price between 50 and 50+10           or ss_coupon_amt between 13008 and 13008+1000           or ss_wholesale_cost between 7 and 7+20)) B6 limit 100;
q31#####select  * from (select avg(ss_list_price) B1_LP             ,count(ss_list_price) B1_CNT             ,count(distinct ss_list_price) B1_CNTD       from store_sales       where ss_quantity between 0 and 5         and (ss_list_price between 169 and 169+10               or ss_coupon_amt between 10494 and 10494+1000              or ss_wholesale_cost between 69 and 69+20)) B1,      (select avg(ss_list_price) B2_LP             ,count(ss_list_price) B2_CNT             ,count(distinct ss_list_price) B2_CNTD       from store_sales       where ss_quantity between 6 and 10         and (ss_list_price between 71 and 71+10           or ss_coupon_amt between 16449 and 16449+1000           or ss_wholesale_cost between 45 and 45+20)) B2,      (select avg(ss_list_price) B3_LP             ,count(ss_list_price) B3_CNT             ,count(distinct ss_list_price) B3_CNTD       from store_sales       where ss_quantity between 11 and 15         and (ss_list_price between 142 and 142+10           or ss_coupon_amt between 8078 and 8078+1000           or ss_wholesale_cost between 42 and 42+20)) B3,      (select avg(ss_list_price) B4_LP             ,count(ss_list_price) B4_CNT             ,count(distinct ss_list_price) B4_CNTD       from store_sales       where ss_quantity between 16 and 20         and (ss_list_price between 114 and 114+10           or ss_coupon_amt between 12137 and 12137+1000           or ss_wholesale_cost between 2 and 2+20)) B4,      (select avg(ss_list_price) B5_LP             ,count(ss_list_price) B5_CNT             ,count(distinct ss_list_price) B5_CNTD       from store_sales       where ss_quantity between 21 and 25         and (ss_list_price between 59 and 59+10           or ss_coupon_amt between 11647 and 11647+1000           or ss_wholesale_cost between 10 and 10+20)) B5,      (select avg(ss_list_price) B6_LP             ,count(ss_list_price) B6_CNT             ,count(distinct ss_list_price) B6_CNTD       from store_sales       where ss_quantity between 26 and 30         and (ss_list_price between 185 and 185+10           or ss_coupon_amt between 2028 and 2028+1000           or ss_wholesale_cost between 6 and 6+20)) B6 limit 100;
q32#####select  sum(cs_ext_discount_amt)  as excess_discount_amount from     catalog_sales     ,item     ,date_dim where i_manufact_id = 628 and i_item_sk = cs_item_sk  and d_date between '2002-03-31' and          (cast('2002-03-31' as date) + interval 90 days) and d_date_sk = cs_sold_date_sk  and cs_ext_discount_amt        > (           select              1.3 * avg(cs_ext_discount_amt)           from              catalog_sales             ,date_dim          where                cs_item_sk = i_item_sk            and d_date between '2002-03-31' and                              (cast('2002-03-31' as date) + interval 90 days)           and d_date_sk = cs_sold_date_sk        )  limit 100;
q33#####select  sum(cs_ext_discount_amt)  as excess_discount_amount from     catalog_sales     ,item     ,date_dim where i_manufact_id = 52 and i_item_sk = cs_item_sk  and d_date between '2002-02-15' and          (cast('2002-02-15' as date) + interval 90 days) and d_date_sk = cs_sold_date_sk  and cs_ext_discount_amt        > (           select              1.3 * avg(cs_ext_discount_amt)           from              catalog_sales             ,date_dim          where                cs_item_sk = i_item_sk            and d_date between '2002-02-15' and                              (cast('2002-02-15' as date) + interval 90 days)           and d_date_sk = cs_sold_date_sk        )  limit 100;
q34#####with ss as (  select           i_manufact_id,sum(ss_ext_sales_price) total_sales  from  	store_sales,  	date_dim,          customer_address,          item  where          i_manufact_id in (select   i_manufact_id from  item where i_category in ('Sports'))  and     ss_item_sk              = i_item_sk  and     ss_sold_date_sk         = d_date_sk  and     d_year                  = 1999  and     d_moy                   = 5  and     ss_addr_sk              = ca_address_sk  and     ca_gmt_offset           = -6   group by i_manufact_id),  cs as (  select           i_manufact_id,sum(cs_ext_sales_price) total_sales  from  	catalog_sales,  	date_dim,          customer_address,          item  where          i_manufact_id               in (select   i_manufact_id from  item where i_category in ('Sports'))  and     cs_item_sk              = i_item_sk  and     cs_sold_date_sk         = d_date_sk  and     d_year                  = 1999  and     d_moy                   = 5  and     cs_bill_addr_sk         = ca_address_sk  and     ca_gmt_offset           = -6   group by i_manufact_id),  ws as (  select           i_manufact_id,sum(ws_ext_sales_price) total_sales  from  	web_sales,  	date_dim,          customer_address,          item  where          i_manufact_id               in (select   i_manufact_id from  item where i_category in ('Sports'))  and     ws_item_sk              = i_item_sk  and     ws_sold_date_sk         = d_date_sk  and     d_year                  = 1999  and     d_moy                   = 5  and     ws_bill_addr_sk         = ca_address_sk  and     ca_gmt_offset           = -6  group by i_manufact_id)   select  i_manufact_id ,sum(total_sales) total_sales  from  (select * from ss          union all         select * from cs          union all         select * from ws) tmp1  group by i_manufact_id  order by total_sales limit 100;
q35#####with ss as (  select           i_manufact_id,sum(ss_ext_sales_price) total_sales  from  	store_sales,  	date_dim,          customer_address,          item  where          i_manufact_id in (select   i_manufact_id from  item where i_category in ('Books'))  and     ss_item_sk              = i_item_sk  and     ss_sold_date_sk         = d_date_sk  and     d_year                  = 2000  and     d_moy                   = 1  and     ss_addr_sk              = ca_address_sk  and     ca_gmt_offset           = -6   group by i_manufact_id),  cs as (  select           i_manufact_id,sum(cs_ext_sales_price) total_sales  from  	catalog_sales,  	date_dim,          customer_address,          item  where          i_manufact_id               in (select   i_manufact_id from  item where i_category in ('Books'))  and     cs_item_sk              = i_item_sk  and     cs_sold_date_sk         = d_date_sk  and     d_year                  = 2000  and     d_moy                   = 1  and     cs_bill_addr_sk         = ca_address_sk  and     ca_gmt_offset           = -6   group by i_manufact_id),  ws as (  select           i_manufact_id,sum(ws_ext_sales_price) total_sales  from  	web_sales,  	date_dim,          customer_address,          item  where          i_manufact_id               in (select   i_manufact_id from  item where i_category in ('Books'))  and     ws_item_sk              = i_item_sk  and     ws_sold_date_sk         = d_date_sk  and     d_year                  = 2000  and     d_moy                   = 1  and     ws_bill_addr_sk         = ca_address_sk  and     ca_gmt_offset           = -6  group by i_manufact_id)   select  i_manufact_id ,sum(total_sales) total_sales  from  (select * from ss          union all         select * from cs          union all         select * from ws) tmp1  group by i_manufact_id  order by total_sales limit 100;
q36#####select c_last_name        ,c_first_name        ,c_salutation        ,c_preferred_cust_flag        ,ss_ticket_number        ,cnt from    (select ss_ticket_number           ,ss_customer_sk           ,count(*) cnt     from store_sales,date_dim,store,household_demographics     where store_sales.ss_sold_date_sk = date_dim.d_date_sk     and store_sales.ss_store_sk = store.s_store_sk       and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk     and (date_dim.d_dom between 1 and 3 or date_dim.d_dom between 25 and 28)     and (household_demographics.hd_buy_potential = '1001-5000' or          household_demographics.hd_buy_potential = '5001-10000')     and household_demographics.hd_vehicle_count > 0     and (case when household_demographics.hd_vehicle_count > 0  	then household_demographics.hd_dep_count/ household_demographics.hd_vehicle_count  	else null  	end)  > 1.2     and date_dim.d_year in (1998,1998+1,1998+2)     and store.s_county in ('Walker County','Williamson County','Ziebach County','Walker County',                            'Ziebach County','Ziebach County','Ziebach County','Ziebach County')     group by ss_ticket_number,ss_customer_sk) dn,customer     where ss_customer_sk = c_customer_sk       and cnt between 15 and 20     order by c_last_name,c_first_name,c_salutation,c_preferred_cust_flag desc, ss_ticket_number;
q37#####select c_last_name        ,c_first_name        ,c_salutation        ,c_preferred_cust_flag        ,ss_ticket_number        ,cnt from    (select ss_ticket_number           ,ss_customer_sk           ,count(*) cnt     from store_sales,date_dim,store,household_demographics     where store_sales.ss_sold_date_sk = date_dim.d_date_sk     and store_sales.ss_store_sk = store.s_store_sk       and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk     and (date_dim.d_dom between 1 and 3 or date_dim.d_dom between 25 and 28)     and (household_demographics.hd_buy_potential = '501-1000' or          household_demographics.hd_buy_potential = 'Unknown')     and household_demographics.hd_vehicle_count > 0     and (case when household_demographics.hd_vehicle_count > 0  	then household_demographics.hd_dep_count/ household_demographics.hd_vehicle_count  	else null  	end)  > 1.2     and date_dim.d_year in (2000,2000+1,2000+2)     and store.s_county in ('Ziebach County','Walker County','Williamson County','Walker County',                            'Ziebach County','Ziebach County','Ziebach County','Ziebach County')     group by ss_ticket_number,ss_customer_sk) dn,customer     where ss_customer_sk = c_customer_sk       and cnt between 15 and 20     order by c_last_name,c_first_name,c_salutation,c_preferred_cust_flag desc, ss_ticket_number;
q38#####select      ca_state,   cd_gender,   cd_marital_status,   cd_dep_count,   count(*) cnt1,   sum(cd_dep_count),   min(cd_dep_count),   min(cd_dep_count),   cd_dep_employed_count,   count(*) cnt2,   sum(cd_dep_employed_count),   min(cd_dep_employed_count),   min(cd_dep_employed_count),   cd_dep_college_count,   count(*) cnt3,   sum(cd_dep_college_count),   min(cd_dep_college_count),   min(cd_dep_college_count)  from   customer c,customer_address ca,customer_demographics  where   c.c_current_addr_sk = ca.ca_address_sk and   cd_demo_sk = c.c_current_cdemo_sk and    exists (select *           from store_sales,date_dim           where c.c_customer_sk = ss_customer_sk and                 ss_sold_date_sk = d_date_sk and                 d_year = 2000 and                 d_qoy < 4) and    (exists (select *             from web_sales,date_dim             where c.c_customer_sk = ws_bill_customer_sk and                   ws_sold_date_sk = d_date_sk and                   d_year = 2000 and                   d_qoy < 4) or      exists (select *              from catalog_sales,date_dim             where c.c_customer_sk = cs_ship_customer_sk and                   cs_sold_date_sk = d_date_sk and                   d_year = 2000 and                   d_qoy < 4))  group by ca_state,           cd_gender,           cd_marital_status,           cd_dep_count,           cd_dep_employed_count,           cd_dep_college_count  order by ca_state,           cd_gender,           cd_marital_status,           cd_dep_count,           cd_dep_employed_count,           cd_dep_college_count  limit 100;
q39#####select      ca_state,   cd_gender,   cd_marital_status,   cd_dep_count,   count(*) cnt1,   avg(cd_dep_count),   avg(cd_dep_count),   avg(cd_dep_count),   cd_dep_employed_count,   count(*) cnt2,   avg(cd_dep_employed_count),   avg(cd_dep_employed_count),   avg(cd_dep_employed_count),   cd_dep_college_count,   count(*) cnt3,   avg(cd_dep_college_count),   avg(cd_dep_college_count),   avg(cd_dep_college_count)  from   customer c,customer_address ca,customer_demographics  where   c.c_current_addr_sk = ca.ca_address_sk and   cd_demo_sk = c.c_current_cdemo_sk and    exists (select *           from store_sales,date_dim           where c.c_customer_sk = ss_customer_sk and                 ss_sold_date_sk = d_date_sk and                 d_year = 2002 and                 d_qoy < 4) and    (exists (select *             from web_sales,date_dim             where c.c_customer_sk = ws_bill_customer_sk and                   ws_sold_date_sk = d_date_sk and                   d_year = 2002 and                   d_qoy < 4) or      exists (select *              from catalog_sales,date_dim             where c.c_customer_sk = cs_ship_customer_sk and                   cs_sold_date_sk = d_date_sk and                   d_year = 2002 and                   d_qoy < 4))  group by ca_state,           cd_gender,           cd_marital_status,           cd_dep_count,           cd_dep_employed_count,           cd_dep_college_count  order by ca_state,           cd_gender,           cd_marital_status,           cd_dep_count,           cd_dep_employed_count,           cd_dep_college_count  limit 100;
q40#####select  i_item_id        ,i_item_desc        ,i_current_price  from item, inventory, date_dim, catalog_sales  where i_current_price between 41 and 41 + 30  and inv_item_sk = i_item_sk  and d_date_sk=inv_date_sk  and d_date between cast('2000-03-23' as date) and (cast('2000-03-23' as date) + interval 60 days)  and i_manufact_id in (778,777,716,870)  and inv_quantity_on_hand between 100 and 500  and cs_item_sk = i_item_sk  group by i_item_id,i_item_desc,i_current_price  order by i_item_id  limit 100;
q41#####select  i_item_id        ,i_item_desc        ,i_current_price  from item, inventory, date_dim, catalog_sales  where i_current_price between 18 and 18 + 30  and inv_item_sk = i_item_sk  and d_date_sk=inv_date_sk  and d_date between cast('2001-01-10' as date) and (cast('2001-01-10' as date) + interval 60 days)  and i_manufact_id in (897,939,949,742)  and inv_quantity_on_hand between 100 and 500  and cs_item_sk = i_item_sk  group by i_item_id,i_item_desc,i_current_price  order by i_item_id  limit 100;
q42#####select      w_state   ,i_item_id   ,sum(case when (cast(d_date as date) < cast ('2001-05-02' as date))   		then cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_before   ,sum(case when (cast(d_date as date) >= cast ('2001-05-02' as date))   		then cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_after  from    catalog_sales left outer join catalog_returns on        (cs_order_number = cr_order_number          and cs_item_sk = cr_item_sk)   ,warehouse    ,item   ,date_dim  where      i_current_price between 0.99 and 1.49  and i_item_sk          = cs_item_sk  and cs_warehouse_sk    = w_warehouse_sk   and cs_sold_date_sk    = d_date_sk  and d_date between (cast ('2001-05-02' as date) - interval 30 days)                 and (cast ('2001-05-02' as date) + interval 30 days)   group by     w_state,i_item_id  order by w_state,i_item_id limit 100;
q43#####select      w_state   ,i_item_id   ,sum(case when (cast(d_date as date) < cast ('2002-03-03' as date))   		then cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_before   ,sum(case when (cast(d_date as date) >= cast ('2002-03-03' as date))   		then cs_sales_price - coalesce(cr_refunded_cash,0) else 0 end) as sales_after  from    catalog_sales left outer join catalog_returns on        (cs_order_number = cr_order_number          and cs_item_sk = cr_item_sk)   ,warehouse    ,item   ,date_dim  where      i_current_price between 0.99 and 1.49  and i_item_sk          = cs_item_sk  and cs_warehouse_sk    = w_warehouse_sk   and cs_sold_date_sk    = d_date_sk  and d_date between (cast ('2002-03-03' as date) - interval 30 days)                 and (cast ('2002-03-03' as date) + interval 30 days)   group by     w_state,i_item_id  order by w_state,i_item_id limit 100;
q44#####select  distinct(i_product_name)  from item i1  where i_manufact_id between 893 and 893+40     and (select count(*) as item_cnt         from item         where (i_manufact = i1.i_manufact and         ((i_category = 'Women' and          (i_color = 'lime' or i_color = 'sandy') and          (i_units = 'Ounce' or i_units = 'Cup') and         (i_size = 'small' or i_size = 'petite')         ) or         (i_category = 'Women' and         (i_color = 'lemon' or i_color = 'snow') and         (i_units = 'Carton' or i_units = 'Gross') and         (i_size = 'extra large' or i_size = 'economy')         ) or         (i_category = 'Men' and         (i_color = 'wheat' or i_color = 'lawn') and         (i_units = 'Ton' or i_units = 'Pallet') and         (i_size = 'large' or i_size = 'medium')         ) or         (i_category = 'Men' and         (i_color = 'blanched' or i_color = 'aquamarine') and         (i_units = 'Lb' or i_units = 'Tsp') and         (i_size = 'small' or i_size = 'petite')         ))) or        (i_manufact = i1.i_manufact and         ((i_category = 'Women' and          (i_color = 'floral' or i_color = 'ivory') and          (i_units = 'Oz' or i_units = 'Bunch') and         (i_size = 'small' or i_size = 'petite')         ) or         (i_category = 'Women' and         (i_color = 'cream' or i_color = 'honeydew') and         (i_units = 'Unknown' or i_units = 'Each') and         (i_size = 'extra large' or i_size = 'economy')         ) or         (i_category = 'Men' and         (i_color = 'pale' or i_color = 'coral') and         (i_units = 'Gram' or i_units = 'N/A') and         (i_size = 'large' or i_size = 'medium')         ) or         (i_category = 'Men' and         (i_color = 'steel' or i_color = 'misty') and         (i_units = 'Case' or i_units = 'Dram') and         (i_size = 'small' or i_size = 'petite')         )))) > 0  order by i_product_name  limit 100;
q45#####select  distinct(i_product_name)  from item i1  where i_manufact_id between 760 and 760+40     and (select count(*) as item_cnt         from item         where (i_manufact = i1.i_manufact and         ((i_category = 'Women' and          (i_color = 'bisque' or i_color = 'pale') and          (i_units = 'Box' or i_units = 'Unknown') and         (i_size = 'medium' or i_size = 'small')         ) or         (i_category = 'Women' and         (i_color = 'floral' or i_color = 'blue') and         (i_units = 'Ounce' or i_units = 'Dram') and         (i_size = 'economy' or i_size = 'large')         ) or         (i_category = 'Men' and         (i_color = 'lawn' or i_color = 'dark') and         (i_units = 'Cup' or i_units = 'N/A') and         (i_size = 'extra large' or i_size = 'N/A')         ) or         (i_category = 'Men' and         (i_color = 'lace' or i_color = 'coral') and         (i_units = 'Gross' or i_units = 'Case') and         (i_size = 'medium' or i_size = 'small')         ))) or        (i_manufact = i1.i_manufact and         ((i_category = 'Women' and          (i_color = 'dodger' or i_color = 'orchid') and          (i_units = 'Bundle' or i_units = 'Pound') and         (i_size = 'medium' or i_size = 'small')         ) or         (i_category = 'Women' and         (i_color = 'beige' or i_color = 'cornsilk') and         (i_units = 'Ton' or i_units = 'Dozen') and         (i_size = 'economy' or i_size = 'large')         ) or         (i_category = 'Men' and         (i_color = 'thistle' or i_color = 'ivory') and         (i_units = 'Gram' or i_units = 'Carton') and         (i_size = 'extra large' or i_size = 'N/A')         ) or         (i_category = 'Men' and         (i_color = 'blanched' or i_color = 'cream') and         (i_units = 'Oz' or i_units = 'Pallet') and         (i_size = 'medium' or i_size = 'small')         )))) > 0  order by i_product_name  limit 100;
q46#####select  c_last_name        ,c_first_name        ,ca_city        ,bought_city        ,ss_ticket_number        ,amt,profit   from    (select ss_ticket_number           ,ss_customer_sk           ,ca_city bought_city           ,sum(ss_coupon_amt) amt           ,sum(ss_net_profit) profit     from store_sales,date_dim,store,household_demographics,customer_address      where store_sales.ss_sold_date_sk = date_dim.d_date_sk     and store_sales.ss_store_sk = store.s_store_sk       and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk     and store_sales.ss_addr_sk = customer_address.ca_address_sk     and (household_demographics.hd_dep_count = 3 or          household_demographics.hd_vehicle_count= 1)     and date_dim.d_dow in (6,0)     and date_dim.d_year in (1998,1998+1,1998+2)      and store.s_city in ('Riverside','Five Points','Oak Grove','Midway','Fairview')      group by ss_ticket_number,ss_customer_sk,ss_addr_sk,ca_city) dn,customer,customer_address current_addr     where ss_customer_sk = c_customer_sk       and customer.c_current_addr_sk = current_addr.ca_address_sk       and current_addr.ca_city <> bought_city   order by c_last_name           ,c_first_name           ,ca_city           ,bought_city           ,ss_ticket_number   limit 100;
q47#####select  c_last_name        ,c_first_name        ,ca_city        ,bought_city        ,ss_ticket_number        ,amt,profit   from    (select ss_ticket_number           ,ss_customer_sk           ,ca_city bought_city           ,sum(ss_coupon_amt) amt           ,sum(ss_net_profit) profit     from store_sales,date_dim,store,household_demographics,customer_address      where store_sales.ss_sold_date_sk = date_dim.d_date_sk     and store_sales.ss_store_sk = store.s_store_sk       and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk     and store_sales.ss_addr_sk = customer_address.ca_address_sk     and (household_demographics.hd_dep_count = 7 or          household_demographics.hd_vehicle_count= 0)     and date_dim.d_dow in (6,0)     and date_dim.d_year in (1999,1999+1,1999+2)      and store.s_city in ('Midway','Pleasant Hill','Fairview','Oak Grove','Five Points')      group by ss_ticket_number,ss_customer_sk,ss_addr_sk,ca_city) dn,customer,customer_address current_addr     where ss_customer_sk = c_customer_sk       and customer.c_current_addr_sk = current_addr.ca_address_sk       and current_addr.ca_city <> bought_city   order by c_last_name           ,c_first_name           ,ca_city           ,bought_city           ,ss_ticket_number   limit 100;
q48#####with v1 as(  select i_category, i_brand,         s_store_name, s_company_name,         d_year, d_moy,         sum(ss_sales_price) sum_sales,         avg(sum(ss_sales_price)) over           (partition by i_category, i_brand,                      s_store_name, s_company_name, d_year)           avg_monthly_sales,         rank() over           (partition by i_category, i_brand,                      s_store_name, s_company_name            order by d_year, d_moy) rn  from item, store_sales, date_dim, store  where ss_item_sk = i_item_sk and        ss_sold_date_sk = d_date_sk and        ss_store_sk = s_store_sk and        (          d_year = 2001 or          ( d_year = 2001-1 and d_moy =12) or          ( d_year = 2001+1 and d_moy =1)        )  group by i_category, i_brand,           s_store_name, s_company_name,           d_year, d_moy),  v2 as(  select v1.i_category, v1.i_brand         ,v1.d_year         ,v1.avg_monthly_sales         ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum  from v1, v1 v1_lag, v1 v1_lead  where v1.i_category = v1_lag.i_category and        v1.i_category = v1_lead.i_category and        v1.i_brand = v1_lag.i_brand and        v1.i_brand = v1_lead.i_brand and        v1.s_store_name = v1_lag.s_store_name and        v1.s_store_name = v1_lead.s_store_name and        v1.s_company_name = v1_lag.s_company_name and        v1.s_company_name = v1_lead.s_company_name and        v1.rn = v1_lag.rn + 1 and        v1.rn = v1_lead.rn - 1)   select  *  from v2  where  d_year = 2001 and             avg_monthly_sales > 0 and         case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1  order by sum_sales - avg_monthly_sales, avg_monthly_sales  limit 100;
q49#####with v1 as(  select i_category, i_brand,         s_store_name, s_company_name,         d_year, d_moy,         sum(ss_sales_price) sum_sales,         avg(sum(ss_sales_price)) over           (partition by i_category, i_brand,                      s_store_name, s_company_name, d_year)           avg_monthly_sales,         rank() over           (partition by i_category, i_brand,                      s_store_name, s_company_name            order by d_year, d_moy) rn  from item, store_sales, date_dim, store  where ss_item_sk = i_item_sk and        ss_sold_date_sk = d_date_sk and        ss_store_sk = s_store_sk and        (          d_year = 2001 or          ( d_year = 2001-1 and d_moy =12) or          ( d_year = 2001+1 and d_moy =1)        )  group by i_category, i_brand,           s_store_name, s_company_name,           d_year, d_moy),  v2 as(  select v1.s_store_name, v1.s_company_name         ,v1.d_year, v1.d_moy         ,v1.avg_monthly_sales         ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum  from v1, v1 v1_lag, v1 v1_lead  where v1.i_category = v1_lag.i_category and        v1.i_category = v1_lead.i_category and        v1.i_brand = v1_lag.i_brand and        v1.i_brand = v1_lead.i_brand and        v1.s_store_name = v1_lag.s_store_name and        v1.s_store_name = v1_lead.s_store_name and        v1.s_company_name = v1_lag.s_company_name and        v1.s_company_name = v1_lead.s_company_name and        v1.rn = v1_lag.rn + 1 and        v1.rn = v1_lead.rn - 1)   select  *  from v2  where  d_year = 2001 and             avg_monthly_sales > 0 and         case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1  order by sum_sales - avg_monthly_sales, avg_monthly_sales  limit 100;
q50#####select sum (ss_quantity)  from store_sales, store, customer_demographics, customer_address, date_dim  where s_store_sk = ss_store_sk  and  ss_sold_date_sk = d_date_sk and d_year = 2002  and    (   (    cd_demo_sk = ss_cdemo_sk    and     cd_marital_status = 'U'    and     cd_education_status = '4 yr Degree'    and     ss_sales_price between 100.00 and 150.00      )  or   (   cd_demo_sk = ss_cdemo_sk    and     cd_marital_status = 'M'    and     cd_education_status = 'College'    and     ss_sales_price between 50.00 and 100.00      )  or   (   cd_demo_sk = ss_cdemo_sk   and     cd_marital_status = 'W'    and     cd_education_status = 'Advanced Degree'    and     ss_sales_price between 150.00 and 200.00    )  )  and  (   (   ss_addr_sk = ca_address_sk   and   ca_country = 'United States'   and   ca_state in ('OK', 'KY', 'IN')   and ss_net_profit between 0 and 2000     )  or   (ss_addr_sk = ca_address_sk   and   ca_country = 'United States'   and   ca_state in ('WI', 'CO', 'MI')   and ss_net_profit between 150 and 3000    )  or   (ss_addr_sk = ca_address_sk   and   ca_country = 'United States'   and   ca_state in ('SC', 'MO', 'ID')   and ss_net_profit between 50 and 25000    )  ) ;
q51#####select sum (ss_quantity)  from store_sales, store, customer_demographics, customer_address, date_dim  where s_store_sk = ss_store_sk  and  ss_sold_date_sk = d_date_sk and d_year = 2002  and    (   (    cd_demo_sk = ss_cdemo_sk    and     cd_marital_status = 'M'    and     cd_education_status = 'Advanced Degree'    and     ss_sales_price between 100.00 and 150.00      )  or   (   cd_demo_sk = ss_cdemo_sk    and     cd_marital_status = 'D'    and     cd_education_status = 'Primary'    and     ss_sales_price between 50.00 and 100.00      )  or   (   cd_demo_sk = ss_cdemo_sk   and     cd_marital_status = 'U'    and     cd_education_status = '2 yr Degree'    and     ss_sales_price between 150.00 and 200.00    )  )  and  (   (   ss_addr_sk = ca_address_sk   and   ca_country = 'United States'   and   ca_state in ('AR', 'IL', 'IA')   and ss_net_profit between 0 and 2000     )  or   (ss_addr_sk = ca_address_sk   and   ca_country = 'United States'   and   ca_state in ('CO', 'KY', 'CA')   and ss_net_profit between 150 and 3000    )  or   (ss_addr_sk = ca_address_sk   and   ca_country = 'United States'   and   ca_state in ('MN', 'MS', 'PA')   and ss_net_profit between 50 and 25000    )  ) ;
q52#####with my_customers as (  select distinct c_customer_sk         , c_current_addr_sk  from            ( select cs_sold_date_sk sold_date_sk,                  cs_bill_customer_sk customer_sk,                  cs_item_sk item_sk           from   catalog_sales           union all           select ws_sold_date_sk sold_date_sk,                  ws_bill_customer_sk customer_sk,                  ws_item_sk item_sk           from   web_sales          ) cs_or_ws_sales,          item,          date_dim,          customer  where   sold_date_sk = d_date_sk          and item_sk = i_item_sk          and i_category = 'Music'          and i_class = 'classical'          and c_customer_sk = cs_or_ws_sales.customer_sk          and d_moy = 2          and d_year = 2002  )  , my_revenue as (  select c_customer_sk,         sum(ss_ext_sales_price) as revenue  from   my_customers,         store_sales,         customer_address,         store,         date_dim  where  c_current_addr_sk = ca_address_sk         and ca_county = s_county         and ca_state = s_state         and ss_sold_date_sk = d_date_sk         and c_customer_sk = ss_customer_sk         and d_month_seq between (select distinct d_month_seq+1                                  from   date_dim where d_year = 2002 and d_moy = 2)                            and  (select distinct d_month_seq+3                                  from   date_dim where d_year = 2002 and d_moy = 2)  group by c_customer_sk  )  , segments as  (select cast((revenue/50) as int) as segment   from   my_revenue  )   select  segment, count(*) as num_customers, segment*50 as segment_base  from segments  group by segment  order by segment, num_customers  limit 100;
q53#####with my_customers as (  select distinct c_customer_sk         , c_current_addr_sk  from            ( select cs_sold_date_sk sold_date_sk,                  cs_bill_customer_sk customer_sk,                  cs_item_sk item_sk           from   catalog_sales           union all           select ws_sold_date_sk sold_date_sk,                  ws_bill_customer_sk customer_sk,                  ws_item_sk item_sk           from   web_sales          ) cs_or_ws_sales,          item,          date_dim,          customer  where   sold_date_sk = d_date_sk          and item_sk = i_item_sk          and i_category = 'Electronics'          and i_class = 'memory'          and c_customer_sk = cs_or_ws_sales.customer_sk          and d_moy = 2          and d_year = 2001  )  , my_revenue as (  select c_customer_sk,         sum(ss_ext_sales_price) as revenue  from   my_customers,         store_sales,         customer_address,         store,         date_dim  where  c_current_addr_sk = ca_address_sk         and ca_county = s_county         and ca_state = s_state         and ss_sold_date_sk = d_date_sk         and c_customer_sk = ss_customer_sk         and d_month_seq between (select distinct d_month_seq+1                                  from   date_dim where d_year = 2001 and d_moy = 2)                            and  (select distinct d_month_seq+3                                  from   date_dim where d_year = 2001 and d_moy = 2)  group by c_customer_sk  )  , segments as  (select cast((revenue/50) as int) as segment   from   my_revenue  )   select  segment, count(*) as num_customers, segment*50 as segment_base  from segments  group by segment  order by segment, num_customers  limit 100;
q54#####select  i_brand_id brand_id, i_brand brand,  	sum(ss_ext_sales_price) ext_price  from date_dim, store_sales, item  where d_date_sk = ss_sold_date_sk  	and ss_item_sk = i_item_sk  	and i_manager_id=15  	and d_moy=12  	and d_year=2000  group by i_brand, i_brand_id  order by ext_price desc, i_brand_id limit 100 ;
q55#####select  i_brand_id brand_id, i_brand brand,  	sum(ss_ext_sales_price) ext_price  from date_dim, store_sales, item  where d_date_sk = ss_sold_date_sk  	and ss_item_sk = i_item_sk  	and i_manager_id=57  	and d_moy=11  	and d_year=2000  group by i_brand, i_brand_id  order by ext_price desc, i_brand_id limit 100 ;
q56#####with ss as (  select i_item_id,sum(ss_ext_sales_price) total_sales  from  	store_sales,  	date_dim,          customer_address,          item  where i_item_id in (select      i_item_id from item where i_color in ('coral','cream','black'))  and     ss_item_sk              = i_item_sk  and     ss_sold_date_sk         = d_date_sk  and     d_year                  = 2002  and     d_moy                   = 6  and     ss_addr_sk              = ca_address_sk  and     ca_gmt_offset           = -5   group by i_item_id),  cs as (  select i_item_id,sum(cs_ext_sales_price) total_sales  from  	catalog_sales,  	date_dim,          customer_address,          item  where          i_item_id               in (select   i_item_id from item where i_color in ('coral','cream','black'))  and     cs_item_sk              = i_item_sk  and     cs_sold_date_sk         = d_date_sk  and     d_year                  = 2002  and     d_moy                   = 6  and     cs_bill_addr_sk         = ca_address_sk  and     ca_gmt_offset           = -5   group by i_item_id),  ws as (  select i_item_id,sum(ws_ext_sales_price) total_sales  from  	web_sales,  	date_dim,          customer_address,          item  where          i_item_id               in (select   i_item_id from item where i_color in ('coral','cream','black'))  and     ws_item_sk              = i_item_sk  and     ws_sold_date_sk         = d_date_sk  and     d_year                  = 2002  and     d_moy                   = 6  and     ws_bill_addr_sk         = ca_address_sk  and     ca_gmt_offset           = -5  group by i_item_id)   select  i_item_id ,sum(total_sales) total_sales  from  (select * from ss          union all         select * from cs          union all         select * from ws) tmp1  group by i_item_id  order by total_sales,           i_item_id  limit 100;
q57#####with ss as (  select i_item_id,sum(ss_ext_sales_price) total_sales  from  	store_sales,  	date_dim,          customer_address,          item  where i_item_id in (select      i_item_id from item where i_color in ('burnished','green','dark'))  and     ss_item_sk              = i_item_sk  and     ss_sold_date_sk         = d_date_sk  and     d_year                  = 2001  and     d_moy                   = 7  and     ss_addr_sk              = ca_address_sk  and     ca_gmt_offset           = -7   group by i_item_id),  cs as (  select i_item_id,sum(cs_ext_sales_price) total_sales  from  	catalog_sales,  	date_dim,          customer_address,          item  where          i_item_id               in (select   i_item_id from item where i_color in ('burnished','green','dark'))  and     cs_item_sk              = i_item_sk  and     cs_sold_date_sk         = d_date_sk  and     d_year                  = 2001  and     d_moy                   = 7  and     cs_bill_addr_sk         = ca_address_sk  and     ca_gmt_offset           = -7   group by i_item_id),  ws as (  select i_item_id,sum(ws_ext_sales_price) total_sales  from  	web_sales,  	date_dim,          customer_address,          item  where          i_item_id               in (select   i_item_id from item where i_color in ('burnished','green','dark'))  and     ws_item_sk              = i_item_sk  and     ws_sold_date_sk         = d_date_sk  and     d_year                  = 2001  and     d_moy                   = 7  and     ws_bill_addr_sk         = ca_address_sk  and     ca_gmt_offset           = -7  group by i_item_id)   select  i_item_id ,sum(total_sales) total_sales  from  (select * from ss          union all         select * from cs          union all         select * from ws) tmp1  group by i_item_id  order by total_sales,           i_item_id  limit 100;
q58#####with v1 as(  select i_category, i_brand,         cc_name,         d_year, d_moy,         sum(cs_sales_price) sum_sales,         avg(sum(cs_sales_price)) over           (partition by i_category, i_brand,                      cc_name, d_year)           avg_monthly_sales,         rank() over           (partition by i_category, i_brand,                      cc_name            order by d_year, d_moy) rn  from item, catalog_sales, date_dim, call_center  where cs_item_sk = i_item_sk and        cs_sold_date_sk = d_date_sk and        cc_call_center_sk= cs_call_center_sk and        (          d_year = 2001 or          ( d_year = 2001-1 and d_moy =12) or          ( d_year = 2001+1 and d_moy =1)        )  group by i_category, i_brand,           cc_name , d_year, d_moy),  v2 as(  select v1.i_category, v1.i_brand, v1.cc_name         ,v1.d_year         ,v1.avg_monthly_sales         ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum  from v1, v1 v1_lag, v1 v1_lead  where v1.i_category = v1_lag.i_category and        v1.i_category = v1_lead.i_category and        v1.i_brand = v1_lag.i_brand and        v1.i_brand = v1_lead.i_brand and        v1. cc_name = v1_lag. cc_name and        v1. cc_name = v1_lead. cc_name and        v1.rn = v1_lag.rn + 1 and        v1.rn = v1_lead.rn - 1)   select  *  from v2  where  d_year = 2001 and         avg_monthly_sales > 0 and         case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1  order by sum_sales - avg_monthly_sales, sum_sales  limit 100;
q59#####with v1 as(  select i_category, i_brand,         cc_name,         d_year, d_moy,         sum(cs_sales_price) sum_sales,         avg(sum(cs_sales_price)) over           (partition by i_category, i_brand,                      cc_name, d_year)           avg_monthly_sales,         rank() over           (partition by i_category, i_brand,                      cc_name            order by d_year, d_moy) rn  from item, catalog_sales, date_dim, call_center  where cs_item_sk = i_item_sk and        cs_sold_date_sk = d_date_sk and        cc_call_center_sk= cs_call_center_sk and        (          d_year = 1999 or          ( d_year = 1999-1 and d_moy =12) or          ( d_year = 1999+1 and d_moy =1)        )  group by i_category, i_brand,           cc_name , d_year, d_moy),  v2 as(  select v1.i_category         ,v1.d_year, v1.d_moy         ,v1.avg_monthly_sales         ,v1.sum_sales, v1_lag.sum_sales psum, v1_lead.sum_sales nsum  from v1, v1 v1_lag, v1 v1_lead  where v1.i_category = v1_lag.i_category and        v1.i_category = v1_lead.i_category and        v1.i_brand = v1_lag.i_brand and        v1.i_brand = v1_lead.i_brand and        v1. cc_name = v1_lag. cc_name and        v1. cc_name = v1_lead. cc_name and        v1.rn = v1_lag.rn + 1 and        v1.rn = v1_lead.rn - 1)   select  *  from v2  where  d_year = 1999 and         avg_monthly_sales > 0 and         case when avg_monthly_sales > 0 then abs(sum_sales - avg_monthly_sales) / avg_monthly_sales else null end > 0.1  order by sum_sales - avg_monthly_sales, sum_sales  limit 100;
q60#####with ss_items as  (select i_item_id item_id         ,sum(ss_ext_sales_price) ss_item_rev   from store_sales      ,item      ,date_dim  where ss_item_sk = i_item_sk    and d_date in (select d_date                   from date_dim                   where d_week_seq = (select d_week_seq                                        from date_dim                                       where d_date = '2002-05-06'))    and ss_sold_date_sk   = d_date_sk  group by i_item_id),  cs_items as  (select i_item_id item_id         ,sum(cs_ext_sales_price) cs_item_rev   from catalog_sales       ,item       ,date_dim  where cs_item_sk = i_item_sk   and  d_date in (select d_date                   from date_dim                   where d_week_seq = (select d_week_seq                                        from date_dim                                       where d_date = '2002-05-06'))   and  cs_sold_date_sk = d_date_sk  group by i_item_id),  ws_items as  (select i_item_id item_id         ,sum(ws_ext_sales_price) ws_item_rev   from web_sales       ,item       ,date_dim  where ws_item_sk = i_item_sk   and  d_date in (select d_date                   from date_dim                   where d_week_seq =(select d_week_seq                                       from date_dim                                      where d_date = '2002-05-06'))   and ws_sold_date_sk   = d_date_sk  group by i_item_id)   select  ss_items.item_id        ,ss_item_rev        ,ss_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ss_dev        ,cs_item_rev        ,cs_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 cs_dev        ,ws_item_rev        ,ws_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ws_dev        ,(ss_item_rev+cs_item_rev+ws_item_rev)/3 average  from ss_items,cs_items,ws_items  where ss_items.item_id=cs_items.item_id    and ss_items.item_id=ws_items.item_id     and ss_item_rev between 0.9 * cs_item_rev and 1.1 * cs_item_rev    and ss_item_rev between 0.9 * ws_item_rev and 1.1 * ws_item_rev    and cs_item_rev between 0.9 * ss_item_rev and 1.1 * ss_item_rev    and cs_item_rev between 0.9 * ws_item_rev and 1.1 * ws_item_rev    and ws_item_rev between 0.9 * ss_item_rev and 1.1 * ss_item_rev    and ws_item_rev between 0.9 * cs_item_rev and 1.1 * cs_item_rev  order by item_id          ,ss_item_rev  limit 100;
q61#####with ss_items as  (select i_item_id item_id         ,sum(ss_ext_sales_price) ss_item_rev   from store_sales      ,item      ,date_dim  where ss_item_sk = i_item_sk    and d_date in (select d_date                   from date_dim                   where d_week_seq = (select d_week_seq                                        from date_dim                                       where d_date = '2002-06-20'))    and ss_sold_date_sk   = d_date_sk  group by i_item_id),  cs_items as  (select i_item_id item_id         ,sum(cs_ext_sales_price) cs_item_rev   from catalog_sales       ,item       ,date_dim  where cs_item_sk = i_item_sk   and  d_date in (select d_date                   from date_dim                   where d_week_seq = (select d_week_seq                                        from date_dim                                       where d_date = '2002-06-20'))   and  cs_sold_date_sk = d_date_sk  group by i_item_id),  ws_items as  (select i_item_id item_id         ,sum(ws_ext_sales_price) ws_item_rev   from web_sales       ,item       ,date_dim  where ws_item_sk = i_item_sk   and  d_date in (select d_date                   from date_dim                   where d_week_seq =(select d_week_seq                                       from date_dim                                      where d_date = '2002-06-20'))   and ws_sold_date_sk   = d_date_sk  group by i_item_id)   select  ss_items.item_id        ,ss_item_rev        ,ss_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ss_dev        ,cs_item_rev        ,cs_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 cs_dev        ,ws_item_rev        ,ws_item_rev/((ss_item_rev+cs_item_rev+ws_item_rev)/3) * 100 ws_dev        ,(ss_item_rev+cs_item_rev+ws_item_rev)/3 average  from ss_items,cs_items,ws_items  where ss_items.item_id=cs_items.item_id    and ss_items.item_id=ws_items.item_id     and ss_item_rev between 0.9 * cs_item_rev and 1.1 * cs_item_rev    and ss_item_rev between 0.9 * ws_item_rev and 1.1 * ws_item_rev    and cs_item_rev between 0.9 * ss_item_rev and 1.1 * ss_item_rev    and cs_item_rev between 0.9 * ws_item_rev and 1.1 * ws_item_rev    and ws_item_rev between 0.9 * ss_item_rev and 1.1 * ss_item_rev    and ws_item_rev between 0.9 * cs_item_rev and 1.1 * cs_item_rev  order by item_id          ,ss_item_rev  limit 100;
q62#####with ss as (  select           i_item_id,sum(ss_ext_sales_price) total_sales  from  	store_sales,  	date_dim,          customer_address,          item  where          i_item_id in (select   i_item_id from  item where i_category in ('Children'))  and     ss_item_sk              = i_item_sk  and     ss_sold_date_sk         = d_date_sk  and     d_year                  = 2002  and     d_moy                   = 9  and     ss_addr_sk              = ca_address_sk  and     ca_gmt_offset           = -6   group by i_item_id),  cs as (  select           i_item_id,sum(cs_ext_sales_price) total_sales  from  	catalog_sales,  	date_dim,          customer_address,          item  where          i_item_id               in (select   i_item_id from  item where i_category in ('Children'))  and     cs_item_sk              = i_item_sk  and     cs_sold_date_sk         = d_date_sk  and     d_year                  = 2002  and     d_moy                   = 9  and     cs_bill_addr_sk         = ca_address_sk  and     ca_gmt_offset           = -6   group by i_item_id),  ws as (  select           i_item_id,sum(ws_ext_sales_price) total_sales  from  	web_sales,  	date_dim,          customer_address,          item  where          i_item_id               in (select   i_item_id from  item where i_category in ('Children'))  and     ws_item_sk              = i_item_sk  and     ws_sold_date_sk         = d_date_sk  and     d_year                  = 2002  and     d_moy                   = 9  and     ws_bill_addr_sk         = ca_address_sk  and     ca_gmt_offset           = -6  group by i_item_id)   select      i_item_id ,sum(total_sales) total_sales  from  (select * from ss          union all         select * from cs          union all         select * from ws) tmp1  group by i_item_id  order by i_item_id       ,total_sales  limit 100;
q63#####with ss as (  select           i_item_id,sum(ss_ext_sales_price) total_sales  from  	store_sales,  	date_dim,          customer_address,          item  where          i_item_id in (select   i_item_id from  item where i_category in ('Men'))  and     ss_item_sk              = i_item_sk  and     ss_sold_date_sk         = d_date_sk  and     d_year                  = 1999  and     d_moy                   = 10  and     ss_addr_sk              = ca_address_sk  and     ca_gmt_offset           = -6   group by i_item_id),  cs as (  select           i_item_id,sum(cs_ext_sales_price) total_sales  from  	catalog_sales,  	date_dim,          customer_address,          item  where          i_item_id               in (select   i_item_id from  item where i_category in ('Men'))  and     cs_item_sk              = i_item_sk  and     cs_sold_date_sk         = d_date_sk  and     d_year                  = 1999  and     d_moy                   = 10  and     cs_bill_addr_sk         = ca_address_sk  and     ca_gmt_offset           = -6   group by i_item_id),  ws as (  select           i_item_id,sum(ws_ext_sales_price) total_sales  from  	web_sales,  	date_dim,          customer_address,          item  where          i_item_id               in (select   i_item_id from  item where i_category in ('Men'))  and     ws_item_sk              = i_item_sk  and     ws_sold_date_sk         = d_date_sk  and     d_year                  = 1999  and     d_moy                   = 10  and     ws_bill_addr_sk         = ca_address_sk  and     ca_gmt_offset           = -6  group by i_item_id)   select      i_item_id ,sum(total_sales) total_sales  from  (select * from ss          union all         select * from cs          union all         select * from ws) tmp1  group by i_item_id  order by i_item_id       ,total_sales  limit 100;
q64#####select             w_warehouse_name  	,w_warehouse_sq_ft  	,w_city  	,w_county  	,w_state  	,w_country         ,ship_carriers         ,year  	,sum(jan_sales) as jan_sales  	,sum(feb_sales) as feb_sales  	,sum(mar_sales) as mar_sales  	,sum(apr_sales) as apr_sales  	,sum(may_sales) as may_sales  	,sum(jun_sales) as jun_sales  	,sum(jul_sales) as jul_sales  	,sum(aug_sales) as aug_sales  	,sum(sep_sales) as sep_sales  	,sum(oct_sales) as oct_sales  	,sum(nov_sales) as nov_sales  	,sum(dec_sales) as dec_sales  	,sum(jan_sales/w_warehouse_sq_ft) as jan_sales_per_sq_foot  	,sum(feb_sales/w_warehouse_sq_ft) as feb_sales_per_sq_foot  	,sum(mar_sales/w_warehouse_sq_ft) as mar_sales_per_sq_foot  	,sum(apr_sales/w_warehouse_sq_ft) as apr_sales_per_sq_foot  	,sum(may_sales/w_warehouse_sq_ft) as may_sales_per_sq_foot  	,sum(jun_sales/w_warehouse_sq_ft) as jun_sales_per_sq_foot  	,sum(jul_sales/w_warehouse_sq_ft) as jul_sales_per_sq_foot  	,sum(aug_sales/w_warehouse_sq_ft) as aug_sales_per_sq_foot  	,sum(sep_sales/w_warehouse_sq_ft) as sep_sales_per_sq_foot  	,sum(oct_sales/w_warehouse_sq_ft) as oct_sales_per_sq_foot  	,sum(nov_sales/w_warehouse_sq_ft) as nov_sales_per_sq_foot  	,sum(dec_sales/w_warehouse_sq_ft) as dec_sales_per_sq_foot  	,sum(jan_net) as jan_net  	,sum(feb_net) as feb_net  	,sum(mar_net) as mar_net  	,sum(apr_net) as apr_net  	,sum(may_net) as may_net  	,sum(jun_net) as jun_net  	,sum(jul_net) as jul_net  	,sum(aug_net) as aug_net  	,sum(sep_net) as sep_net  	,sum(oct_net) as oct_net  	,sum(nov_net) as nov_net  	,sum(dec_net) as dec_net  from (      select   	w_warehouse_name  	,w_warehouse_sq_ft  	,w_city  	,w_county  	,w_state  	,w_country         ,concat('UPS'  , ',' , 'ALLIANCE') as ship_carriers        ,d_year as year  	,sum(case when d_moy = 1   		then ws_ext_list_price* ws_quantity else 0 end) as jan_sales  	,sum(case when d_moy = 2   		then ws_ext_list_price* ws_quantity else 0 end) as feb_sales  	,sum(case when d_moy = 3   		then ws_ext_list_price* ws_quantity else 0 end) as mar_sales  	,sum(case when d_moy = 4   		then ws_ext_list_price* ws_quantity else 0 end) as apr_sales  	,sum(case when d_moy = 5   		then ws_ext_list_price* ws_quantity else 0 end) as may_sales  	,sum(case when d_moy = 6   		then ws_ext_list_price* ws_quantity else 0 end) as jun_sales  	,sum(case when d_moy = 7   		then ws_ext_list_price* ws_quantity else 0 end) as jul_sales  	,sum(case when d_moy = 8   		then ws_ext_list_price* ws_quantity else 0 end) as aug_sales  	,sum(case when d_moy = 9   		then ws_ext_list_price* ws_quantity else 0 end) as sep_sales  	,sum(case when d_moy = 10   		then ws_ext_list_price* ws_quantity else 0 end) as oct_sales  	,sum(case when d_moy = 11  		then ws_ext_list_price* ws_quantity else 0 end) as nov_sales  	,sum(case when d_moy = 12  		then ws_ext_list_price* ws_quantity else 0 end) as dec_sales  	,sum(case when d_moy = 1   		then ws_net_profit * ws_quantity else 0 end) as jan_net  	,sum(case when d_moy = 2  		then ws_net_profit * ws_quantity else 0 end) as feb_net  	,sum(case when d_moy = 3   		then ws_net_profit * ws_quantity else 0 end) as mar_net  	,sum(case when d_moy = 4   		then ws_net_profit * ws_quantity else 0 end) as apr_net  	,sum(case when d_moy = 5   		then ws_net_profit * ws_quantity else 0 end) as may_net  	,sum(case when d_moy = 6   		then ws_net_profit * ws_quantity else 0 end) as jun_net  	,sum(case when d_moy = 7   		then ws_net_profit * ws_quantity else 0 end) as jul_net  	,sum(case when d_moy = 8   		then ws_net_profit * ws_quantity else 0 end) as aug_net  	,sum(case when d_moy = 9   		then ws_net_profit * ws_quantity else 0 end) as sep_net  	,sum(case when d_moy = 10   		then ws_net_profit * ws_quantity else 0 end) as oct_net  	,sum(case when d_moy = 11  		then ws_net_profit * ws_quantity else 0 end) as nov_net  	,sum(case when d_moy = 12  		then ws_net_profit * ws_quantity else 0 end) as dec_net      from           web_sales          ,warehouse          ,date_dim          ,time_dim  	  ,ship_mode      where             ws_warehouse_sk =  w_warehouse_sk         and ws_sold_date_sk = d_date_sk         and ws_sold_time_sk = t_time_sk  	and ws_ship_mode_sk = sm_ship_mode_sk         and d_year = 1998  	and t_time between 46442 and 46442+28800   	and sm_carrier in ('UPS','ALLIANCE')      group by          w_warehouse_name  	,w_warehouse_sq_ft  	,w_city  	,w_county  	,w_state  	,w_country        ,d_year  union all      select   	w_warehouse_name  	,w_warehouse_sq_ft  	,w_city  	,w_county  	,w_state  	,w_country         ,concat('UPS'  , ',' , 'ALLIANCE') as ship_carriers 	,d_year as year  	,sum(case when d_moy = 1   		then cs_sales_price* cs_quantity else 0 end) as jan_sales  	,sum(case when d_moy = 2   		then cs_sales_price* cs_quantity else 0 end) as feb_sales  	,sum(case when d_moy = 3   		then cs_sales_price* cs_quantity else 0 end) as mar_sales  	,sum(case when d_moy = 4   		then cs_sales_price* cs_quantity else 0 end) as apr_sales  	,sum(case when d_moy = 5   		then cs_sales_price* cs_quantity else 0 end) as may_sales  	,sum(case when d_moy = 6   		then cs_sales_price* cs_quantity else 0 end) as jun_sales  	,sum(case when d_moy = 7   		then cs_sales_price* cs_quantity else 0 end) as jul_sales  	,sum(case when d_moy = 8   		then cs_sales_price* cs_quantity else 0 end) as aug_sales  	,sum(case when d_moy = 9   		then cs_sales_price* cs_quantity else 0 end) as sep_sales  	,sum(case when d_moy = 10   		then cs_sales_price* cs_quantity else 0 end) as oct_sales  	,sum(case when d_moy = 11  		then cs_sales_price* cs_quantity else 0 end) as nov_sales  	,sum(case when d_moy = 12  		then cs_sales_price* cs_quantity else 0 end) as dec_sales  	,sum(case when d_moy = 1   		then cs_net_paid_inc_ship * cs_quantity else 0 end) as jan_net  	,sum(case when d_moy = 2   		then cs_net_paid_inc_ship * cs_quantity else 0 end) as feb_net  	,sum(case when d_moy = 3   		then cs_net_paid_inc_ship * cs_quantity else 0 end) as mar_net  	,sum(case when d_moy = 4   		then cs_net_paid_inc_ship * cs_quantity else 0 end) as apr_net  	,sum(case when d_moy = 5   		then cs_net_paid_inc_ship * cs_quantity else 0 end) as may_net  	,sum(case when d_moy = 6   		then cs_net_paid_inc_ship * cs_quantity else 0 end) as jun_net  	,sum(case when d_moy = 7   		then cs_net_paid_inc_ship * cs_quantity else 0 end) as jul_net  	,sum(case when d_moy = 8   		then cs_net_paid_inc_ship * cs_quantity else 0 end) as aug_net  	,sum(case when d_moy = 9   		then cs_net_paid_inc_ship * cs_quantity else 0 end) as sep_net  	,sum(case when d_moy = 10   		then cs_net_paid_inc_ship * cs_quantity else 0 end) as oct_net  	,sum(case when d_moy = 11  		then cs_net_paid_inc_ship * cs_quantity else 0 end) as nov_net  	,sum(case when d_moy = 12  		then cs_net_paid_inc_ship * cs_quantity else 0 end) as dec_net      from           catalog_sales          ,warehouse          ,date_dim          ,time_dim  	 ,ship_mode      where             cs_warehouse_sk =  w_warehouse_sk         and cs_sold_date_sk = d_date_sk         and cs_sold_time_sk = t_time_sk  	and cs_ship_mode_sk = sm_ship_mode_sk         and d_year = 1998  	and t_time between 46442 AND 46442+28800   	and sm_carrier in ('UPS','ALLIANCE')      group by          w_warehouse_name  	,w_warehouse_sq_ft  	,w_city  	,w_county  	,w_state  	,w_country        ,d_year  ) x  group by          w_warehouse_name  	,w_warehouse_sq_ft  	,w_city  	,w_county  	,w_state  	,w_country  	,ship_carriers        ,year  order by w_warehouse_name  limit 100;
q65#####select             w_warehouse_name  	,w_warehouse_sq_ft  	,w_city  	,w_county  	,w_state  	,w_country         ,ship_carriers         ,year  	,sum(jan_sales) as jan_sales  	,sum(feb_sales) as feb_sales  	,sum(mar_sales) as mar_sales  	,sum(apr_sales) as apr_sales  	,sum(may_sales) as may_sales  	,sum(jun_sales) as jun_sales  	,sum(jul_sales) as jul_sales  	,sum(aug_sales) as aug_sales  	,sum(sep_sales) as sep_sales  	,sum(oct_sales) as oct_sales  	,sum(nov_sales) as nov_sales  	,sum(dec_sales) as dec_sales  	,sum(jan_sales/w_warehouse_sq_ft) as jan_sales_per_sq_foot  	,sum(feb_sales/w_warehouse_sq_ft) as feb_sales_per_sq_foot  	,sum(mar_sales/w_warehouse_sq_ft) as mar_sales_per_sq_foot  	,sum(apr_sales/w_warehouse_sq_ft) as apr_sales_per_sq_foot  	,sum(may_sales/w_warehouse_sq_ft) as may_sales_per_sq_foot  	,sum(jun_sales/w_warehouse_sq_ft) as jun_sales_per_sq_foot  	,sum(jul_sales/w_warehouse_sq_ft) as jul_sales_per_sq_foot  	,sum(aug_sales/w_warehouse_sq_ft) as aug_sales_per_sq_foot  	,sum(sep_sales/w_warehouse_sq_ft) as sep_sales_per_sq_foot  	,sum(oct_sales/w_warehouse_sq_ft) as oct_sales_per_sq_foot  	,sum(nov_sales/w_warehouse_sq_ft) as nov_sales_per_sq_foot  	,sum(dec_sales/w_warehouse_sq_ft) as dec_sales_per_sq_foot  	,sum(jan_net) as jan_net  	,sum(feb_net) as feb_net  	,sum(mar_net) as mar_net  	,sum(apr_net) as apr_net  	,sum(may_net) as may_net  	,sum(jun_net) as jun_net  	,sum(jul_net) as jul_net  	,sum(aug_net) as aug_net  	,sum(sep_net) as sep_net  	,sum(oct_net) as oct_net  	,sum(nov_net) as nov_net  	,sum(dec_net) as dec_net  from (      select   	w_warehouse_name  	,w_warehouse_sq_ft  	,w_city  	,w_county  	,w_state  	,w_country         ,concat('ORIENTAL'  , ',' , 'USPS') as ship_carriers        ,d_year as year  	,sum(case when d_moy = 1   		then ws_sales_price* ws_quantity else 0 end) as jan_sales  	,sum(case when d_moy = 2   		then ws_sales_price* ws_quantity else 0 end) as feb_sales  	,sum(case when d_moy = 3   		then ws_sales_price* ws_quantity else 0 end) as mar_sales  	,sum(case when d_moy = 4   		then ws_sales_price* ws_quantity else 0 end) as apr_sales  	,sum(case when d_moy = 5   		then ws_sales_price* ws_quantity else 0 end) as may_sales  	,sum(case when d_moy = 6   		then ws_sales_price* ws_quantity else 0 end) as jun_sales  	,sum(case when d_moy = 7   		then ws_sales_price* ws_quantity else 0 end) as jul_sales  	,sum(case when d_moy = 8   		then ws_sales_price* ws_quantity else 0 end) as aug_sales  	,sum(case when d_moy = 9   		then ws_sales_price* ws_quantity else 0 end) as sep_sales  	,sum(case when d_moy = 10   		then ws_sales_price* ws_quantity else 0 end) as oct_sales  	,sum(case when d_moy = 11  		then ws_sales_price* ws_quantity else 0 end) as nov_sales  	,sum(case when d_moy = 12  		then ws_sales_price* ws_quantity else 0 end) as dec_sales  	,sum(case when d_moy = 1   		then ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jan_net  	,sum(case when d_moy = 2  		then ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as feb_net  	,sum(case when d_moy = 3   		then ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as mar_net  	,sum(case when d_moy = 4   		then ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as apr_net  	,sum(case when d_moy = 5   		then ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as may_net  	,sum(case when d_moy = 6   		then ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jun_net  	,sum(case when d_moy = 7   		then ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as jul_net  	,sum(case when d_moy = 8   		then ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as aug_net  	,sum(case when d_moy = 9   		then ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as sep_net  	,sum(case when d_moy = 10   		then ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as oct_net  	,sum(case when d_moy = 11  		then ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as nov_net  	,sum(case when d_moy = 12  		then ws_net_paid_inc_ship_tax * ws_quantity else 0 end) as dec_net      from           web_sales          ,warehouse          ,date_dim          ,time_dim  	  ,ship_mode      where             ws_warehouse_sk =  w_warehouse_sk         and ws_sold_date_sk = d_date_sk         and ws_sold_time_sk = t_time_sk  	and ws_ship_mode_sk = sm_ship_mode_sk         and d_year = 2002  	and t_time between 22275 and 22275+28800   	and sm_carrier in ('ORIENTAL','USPS')      group by          w_warehouse_name  	,w_warehouse_sq_ft  	,w_city  	,w_county  	,w_state  	,w_country        ,d_year  union all      select   	w_warehouse_name  	,w_warehouse_sq_ft  	,w_city  	,w_county  	,w_state  	,w_country         ,concat('ORIENTAL'  , ',' , 'USPS') as ship_carriers 	,d_year as year  	,sum(case when d_moy = 1   		then cs_ext_list_price* cs_quantity else 0 end) as jan_sales  	,sum(case when d_moy = 2   		then cs_ext_list_price* cs_quantity else 0 end) as feb_sales  	,sum(case when d_moy = 3   		then cs_ext_list_price* cs_quantity else 0 end) as mar_sales  	,sum(case when d_moy = 4   		then cs_ext_list_price* cs_quantity else 0 end) as apr_sales  	,sum(case when d_moy = 5   		then cs_ext_list_price* cs_quantity else 0 end) as may_sales  	,sum(case when d_moy = 6   		then cs_ext_list_price* cs_quantity else 0 end) as jun_sales  	,sum(case when d_moy = 7   		then cs_ext_list_price* cs_quantity else 0 end) as jul_sales  	,sum(case when d_moy = 8   		then cs_ext_list_price* cs_quantity else 0 end) as aug_sales  	,sum(case when d_moy = 9   		then cs_ext_list_price* cs_quantity else 0 end) as sep_sales  	,sum(case when d_moy = 10   		then cs_ext_list_price* cs_quantity else 0 end) as oct_sales  	,sum(case when d_moy = 11  		then cs_ext_list_price* cs_quantity else 0 end) as nov_sales  	,sum(case when d_moy = 12  		then cs_ext_list_price* cs_quantity else 0 end) as dec_sales  	,sum(case when d_moy = 1   		then cs_net_paid_inc_tax * cs_quantity else 0 end) as jan_net  	,sum(case when d_moy = 2   		then cs_net_paid_inc_tax * cs_quantity else 0 end) as feb_net  	,sum(case when d_moy = 3   		then cs_net_paid_inc_tax * cs_quantity else 0 end) as mar_net  	,sum(case when d_moy = 4   		then cs_net_paid_inc_tax * cs_quantity else 0 end) as apr_net  	,sum(case when d_moy = 5   		then cs_net_paid_inc_tax * cs_quantity else 0 end) as may_net  	,sum(case when d_moy = 6   		then cs_net_paid_inc_tax * cs_quantity else 0 end) as jun_net  	,sum(case when d_moy = 7   		then cs_net_paid_inc_tax * cs_quantity else 0 end) as jul_net  	,sum(case when d_moy = 8   		then cs_net_paid_inc_tax * cs_quantity else 0 end) as aug_net  	,sum(case when d_moy = 9   		then cs_net_paid_inc_tax * cs_quantity else 0 end) as sep_net  	,sum(case when d_moy = 10   		then cs_net_paid_inc_tax * cs_quantity else 0 end) as oct_net  	,sum(case when d_moy = 11  		then cs_net_paid_inc_tax * cs_quantity else 0 end) as nov_net  	,sum(case when d_moy = 12  		then cs_net_paid_inc_tax * cs_quantity else 0 end) as dec_net      from           catalog_sales          ,warehouse          ,date_dim          ,time_dim  	 ,ship_mode      where             cs_warehouse_sk =  w_warehouse_sk         and cs_sold_date_sk = d_date_sk         and cs_sold_time_sk = t_time_sk  	and cs_ship_mode_sk = sm_ship_mode_sk         and d_year = 2002  	and t_time between 22275 AND 22275+28800   	and sm_carrier in ('ORIENTAL','USPS')      group by          w_warehouse_name  	,w_warehouse_sq_ft  	,w_city  	,w_county  	,w_state  	,w_country        ,d_year  ) x  group by          w_warehouse_name  	,w_warehouse_sq_ft  	,w_city  	,w_county  	,w_state  	,w_country  	,ship_carriers        ,year  order by w_warehouse_name  limit 100;
q66#####select  c_last_name        ,c_first_name        ,ca_city        ,bought_city        ,ss_ticket_number        ,extended_price        ,extended_tax        ,list_price  from (select ss_ticket_number              ,ss_customer_sk              ,ca_city bought_city              ,sum(ss_ext_sales_price) extended_price               ,sum(ss_ext_list_price) list_price              ,sum(ss_ext_tax) extended_tax         from store_sales            ,date_dim            ,store            ,household_demographics            ,customer_address         where store_sales.ss_sold_date_sk = date_dim.d_date_sk          and store_sales.ss_store_sk = store.s_store_sk           and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk         and store_sales.ss_addr_sk = customer_address.ca_address_sk         and date_dim.d_dom between 1 and 2          and (household_demographics.hd_dep_count = 3 or              household_demographics.hd_vehicle_count= 1)         and date_dim.d_year in (1998,1998+1,1998+2)         and store.s_city in ('Riverside','Five Points')        group by ss_ticket_number                ,ss_customer_sk                ,ss_addr_sk,ca_city) dn       ,customer       ,customer_address current_addr  where ss_customer_sk = c_customer_sk    and customer.c_current_addr_sk = current_addr.ca_address_sk    and current_addr.ca_city <> bought_city  order by c_last_name          ,ss_ticket_number  limit 100;
q67#####select  c_last_name        ,c_first_name        ,ca_city        ,bought_city        ,ss_ticket_number        ,extended_price        ,extended_tax        ,list_price  from (select ss_ticket_number              ,ss_customer_sk              ,ca_city bought_city              ,sum(ss_ext_sales_price) extended_price               ,sum(ss_ext_list_price) list_price              ,sum(ss_ext_tax) extended_tax         from store_sales            ,date_dim            ,store            ,household_demographics            ,customer_address         where store_sales.ss_sold_date_sk = date_dim.d_date_sk          and store_sales.ss_store_sk = store.s_store_sk           and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk         and store_sales.ss_addr_sk = customer_address.ca_address_sk         and date_dim.d_dom between 1 and 2          and (household_demographics.hd_dep_count = 7 or              household_demographics.hd_vehicle_count= 0)         and date_dim.d_year in (1999,1999+1,1999+2)         and store.s_city in ('Midway','Pleasant Hill')        group by ss_ticket_number                ,ss_customer_sk                ,ss_addr_sk,ca_city) dn       ,customer       ,customer_address current_addr  where ss_customer_sk = c_customer_sk    and customer.c_current_addr_sk = current_addr.ca_address_sk    and current_addr.ca_city <> bought_city  order by c_last_name          ,ss_ticket_number  limit 100;
q68#####select     cd_gender,   cd_marital_status,   cd_education_status,   count(*) cnt1,   cd_purchase_estimate,   count(*) cnt2,   cd_credit_rating,   count(*) cnt3  from   customer c,customer_address ca,customer_demographics  where   c.c_current_addr_sk = ca.ca_address_sk and   ca_state in ('MT','VA','MI') and   cd_demo_sk = c.c_current_cdemo_sk and    exists (select *           from store_sales,date_dim           where c.c_customer_sk = ss_customer_sk and                 ss_sold_date_sk = d_date_sk and                 d_year = 2003 and                 d_moy between 2 and 2+2) and    (not exists (select *             from web_sales,date_dim             where c.c_customer_sk = ws_bill_customer_sk and                   ws_sold_date_sk = d_date_sk and                   d_year = 2003 and                   d_moy between 2 and 2+2) and     not exists (select *              from catalog_sales,date_dim             where c.c_customer_sk = cs_ship_customer_sk and                   cs_sold_date_sk = d_date_sk and                   d_year = 2003 and                   d_moy between 2 and 2+2))  group by cd_gender,           cd_marital_status,           cd_education_status,           cd_purchase_estimate,           cd_credit_rating  order by cd_gender,           cd_marital_status,           cd_education_status,           cd_purchase_estimate,           cd_credit_rating  limit 100;
q69#####select     cd_gender,   cd_marital_status,   cd_education_status,   count(*) cnt1,   cd_purchase_estimate,   count(*) cnt2,   cd_credit_rating,   count(*) cnt3  from   customer c,customer_address ca,customer_demographics  where   c.c_current_addr_sk = ca.ca_address_sk and   ca_state in ('MO','TX','WA') and   cd_demo_sk = c.c_current_cdemo_sk and    exists (select *           from store_sales,date_dim           where c.c_customer_sk = ss_customer_sk and                 ss_sold_date_sk = d_date_sk and                 d_year = 2002 and                 d_moy between 4 and 4+2) and    (not exists (select *             from web_sales,date_dim             where c.c_customer_sk = ws_bill_customer_sk and                   ws_sold_date_sk = d_date_sk and                   d_year = 2002 and                   d_moy between 4 and 4+2) and     not exists (select *              from catalog_sales,date_dim             where c.c_customer_sk = cs_ship_customer_sk and                   cs_sold_date_sk = d_date_sk and                   d_year = 2002 and                   d_moy between 4 and 4+2))  group by cd_gender,           cd_marital_status,           cd_education_status,           cd_purchase_estimate,           cd_credit_rating  order by cd_gender,           cd_marital_status,           cd_education_status,           cd_purchase_estimate,           cd_credit_rating  limit 100;
q70#####select c_last_name        ,c_first_name        ,c_salutation        ,c_preferred_cust_flag         ,ss_ticket_number        ,cnt from    (select ss_ticket_number           ,ss_customer_sk           ,count(*) cnt     from store_sales,date_dim,store,household_demographics     where store_sales.ss_sold_date_sk = date_dim.d_date_sk     and store_sales.ss_store_sk = store.s_store_sk       and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk     and date_dim.d_dom between 1 and 2      and (household_demographics.hd_buy_potential = '1001-5000' or          household_demographics.hd_buy_potential = '5001-10000')     and household_demographics.hd_vehicle_count > 0     and case when household_demographics.hd_vehicle_count > 0 then               household_demographics.hd_dep_count/ household_demographics.hd_vehicle_count else null end > 1     and date_dim.d_year in (1998,1998+1,1998+2)     and store.s_county in ('Walker County','Williamson County','Ziebach County','Ziebach County')     group by ss_ticket_number,ss_customer_sk) dj,customer     where ss_customer_sk = c_customer_sk       and cnt between 1 and 5     order by cnt desc, c_last_name asc;
q71#####select c_last_name        ,c_first_name        ,c_salutation        ,c_preferred_cust_flag         ,ss_ticket_number        ,cnt from    (select ss_ticket_number           ,ss_customer_sk           ,count(*) cnt     from store_sales,date_dim,store,household_demographics     where store_sales.ss_sold_date_sk = date_dim.d_date_sk     and store_sales.ss_store_sk = store.s_store_sk       and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk     and date_dim.d_dom between 1 and 2      and (household_demographics.hd_buy_potential = '501-1000' or          household_demographics.hd_buy_potential = 'Unknown')     and household_demographics.hd_vehicle_count > 0     and case when household_demographics.hd_vehicle_count > 0 then               household_demographics.hd_dep_count/ household_demographics.hd_vehicle_count else null end > 1     and date_dim.d_year in (2000,2000+1,2000+2)     and store.s_county in ('Ziebach County','Walker County','Williamson County','Ziebach County')     group by ss_ticket_number,ss_customer_sk) dj,customer     where ss_customer_sk = c_customer_sk       and cnt between 1 and 5     order by cnt desc, c_last_name asc;
q72#####select  channel, col_name, d_year, d_qoy, i_category, COUNT(*) sales_cnt, SUM(ext_sales_price) sales_amt FROM (         SELECT 'store' as channel, 'ss_promo_sk' col_name, d_year, d_qoy, i_category, ss_ext_sales_price ext_sales_price          FROM store_sales, item, date_dim          WHERE ss_promo_sk IS NULL            AND ss_sold_date_sk=d_date_sk            AND ss_item_sk=i_item_sk         UNION ALL         SELECT 'web' as channel, 'ws_ship_addr_sk' col_name, d_year, d_qoy, i_category, ws_ext_sales_price ext_sales_price          FROM web_sales, item, date_dim          WHERE ws_ship_addr_sk IS NULL            AND ws_sold_date_sk=d_date_sk            AND ws_item_sk=i_item_sk         UNION ALL         SELECT 'catalog' as channel, 'cs_ship_mode_sk' col_name, d_year, d_qoy, i_category, cs_ext_sales_price ext_sales_price          FROM catalog_sales, item, date_dim          WHERE cs_ship_mode_sk IS NULL            AND cs_sold_date_sk=d_date_sk            AND cs_item_sk=i_item_sk) foo GROUP BY channel, col_name, d_year, d_qoy, i_category ORDER BY channel, col_name, d_year, d_qoy, i_category limit 100;
q73#####select  channel, col_name, d_year, d_qoy, i_category, COUNT(*) sales_cnt, SUM(ext_sales_price) sales_amt FROM (         SELECT 'store' as channel, 'ss_addr_sk' col_name, d_year, d_qoy, i_category, ss_ext_sales_price ext_sales_price          FROM store_sales, item, date_dim          WHERE ss_addr_sk IS NULL            AND ss_sold_date_sk=d_date_sk            AND ss_item_sk=i_item_sk         UNION ALL         SELECT 'web' as channel, 'ws_ship_hdemo_sk' col_name, d_year, d_qoy, i_category, ws_ext_sales_price ext_sales_price          FROM web_sales, item, date_dim          WHERE ws_ship_hdemo_sk IS NULL            AND ws_sold_date_sk=d_date_sk            AND ws_item_sk=i_item_sk         UNION ALL         SELECT 'catalog' as channel, 'cs_bill_hdemo_sk' col_name, d_year, d_qoy, i_category, cs_ext_sales_price ext_sales_price          FROM catalog_sales, item, date_dim          WHERE cs_bill_hdemo_sk IS NULL            AND cs_sold_date_sk=d_date_sk            AND cs_item_sk=i_item_sk) foo GROUP BY channel, col_name, d_year, d_qoy, i_category ORDER BY channel, col_name, d_year, d_qoy, i_category limit 100;
q74#####select    c_last_name,c_first_name,substr(s_city,1,30),ss_ticket_number,amt,profit   from    (select ss_ticket_number           ,ss_customer_sk           ,store.s_city           ,sum(ss_coupon_amt) amt           ,sum(ss_net_profit) profit     from store_sales,date_dim,store,household_demographics     where store_sales.ss_sold_date_sk = date_dim.d_date_sk     and store_sales.ss_store_sk = store.s_store_sk       and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk     and (household_demographics.hd_dep_count = 8 or household_demographics.hd_vehicle_count > 3)     and date_dim.d_dow = 1     and date_dim.d_year in (2000,2000+1,2000+2)      and store.s_number_employees between 200 and 295     group by ss_ticket_number,ss_customer_sk,ss_addr_sk,store.s_city) ms,customer     where ss_customer_sk = c_customer_sk  order by c_last_name,c_first_name,substr(s_city,1,30), profit limit 100;
q75#####select    c_last_name,c_first_name,substr(s_city,1,30),ss_ticket_number,amt,profit   from    (select ss_ticket_number           ,ss_customer_sk           ,store.s_city           ,sum(ss_coupon_amt) amt           ,sum(ss_net_profit) profit     from store_sales,date_dim,store,household_demographics     where store_sales.ss_sold_date_sk = date_dim.d_date_sk     and store_sales.ss_store_sk = store.s_store_sk       and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk     and (household_demographics.hd_dep_count = 3 or household_demographics.hd_vehicle_count > 4)     and date_dim.d_dow = 1     and date_dim.d_year in (2000,2000+1,2000+2)      and store.s_number_employees between 200 and 295     group by ss_ticket_number,ss_customer_sk,ss_addr_sk,store.s_city) ms,customer     where ss_customer_sk = c_customer_sk  order by c_last_name,c_first_name,substr(s_city,1,30), profit limit 100;
q76#####with customer_total_return as  (select cr_returning_customer_sk as ctr_customer_sk         ,ca_state as ctr_state,   	sum(cr_return_amt_inc_tax) as ctr_total_return  from catalog_returns      ,date_dim      ,customer_address  where cr_returned_date_sk = d_date_sk     and d_year =2002    and cr_returning_addr_sk = ca_address_sk   group by cr_returning_customer_sk          ,ca_state )   select  c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name                    ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset                   ,ca_location_type,ctr_total_return  from customer_total_return ctr1      ,customer_address      ,customer  where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2  			  from customer_total_return ctr2                    	  where ctr1.ctr_state = ctr2.ctr_state)        and ca_address_sk = c_current_addr_sk        and ca_state = 'MO'        and ctr1.ctr_customer_sk = c_customer_sk  order by c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name                    ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset                   ,ca_location_type,ctr_total_return  limit 100;
q77#####with customer_total_return as  (select cr_returning_customer_sk as ctr_customer_sk         ,ca_state as ctr_state,   	sum(cr_return_amt_inc_tax) as ctr_total_return  from catalog_returns      ,date_dim      ,customer_address  where cr_returned_date_sk = d_date_sk     and d_year =2002    and cr_returning_addr_sk = ca_address_sk   group by cr_returning_customer_sk          ,ca_state )   select  c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name                    ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset                   ,ca_location_type,ctr_total_return  from customer_total_return ctr1      ,customer_address      ,customer  where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2  			  from customer_total_return ctr2                    	  where ctr1.ctr_state = ctr2.ctr_state)        and ca_address_sk = c_current_addr_sk        and ca_state = 'IA'        and ctr1.ctr_customer_sk = c_customer_sk  order by c_customer_id,c_salutation,c_first_name,c_last_name,ca_street_number,ca_street_name                    ,ca_street_type,ca_suite_number,ca_city,ca_county,ca_state,ca_zip,ca_country,ca_gmt_offset                   ,ca_location_type,ctr_total_return  limit 100;
q78#####select  i_item_id        ,i_item_desc        ,i_current_price  from item, inventory, date_dim, store_sales  where i_current_price between 17 and 17+30  and inv_item_sk = i_item_sk  and d_date_sk=inv_date_sk  and d_date between cast('1998-04-06' as date) and (cast('1998-04-06' as date) + interval 60 days)  and i_manufact_id in (316,711,408,301)  and inv_quantity_on_hand between 100 and 500  and ss_item_sk = i_item_sk  group by i_item_id,i_item_desc,i_current_price  order by i_item_id  limit 100;
q79#####select  i_item_id        ,i_item_desc        ,i_current_price  from item, inventory, date_dim, store_sales  where i_current_price between 61 and 61+30  and inv_item_sk = i_item_sk  and d_date_sk=inv_date_sk  and d_date between cast('2000-04-11' as date) and (cast('2000-04-11' as date) + interval 60 days)  and i_manufact_id in (351,110,53,859)  and inv_quantity_on_hand between 100 and 500  and ss_item_sk = i_item_sk  group by i_item_id,i_item_desc,i_current_price  order by i_item_id  limit 100;
q80#####with sr_items as  (select i_item_id item_id,         sum(sr_return_quantity) sr_item_qty  from store_returns,       item,       date_dim  where sr_item_sk = i_item_sk  and   d_date    in  	(select d_date 	from date_dim 	where d_week_seq in  		(select d_week_seq 		from date_dim 	  where d_date in ('2002-02-14','2002-08-28','2002-11-23')))  and   sr_returned_date_sk   = d_date_sk  group by i_item_id),  cr_items as  (select i_item_id item_id,         sum(cr_return_quantity) cr_item_qty  from catalog_returns,       item,       date_dim  where cr_item_sk = i_item_sk  and   d_date    in  	(select d_date 	from date_dim 	where d_week_seq in  		(select d_week_seq 		from date_dim 	  where d_date in ('2002-02-14','2002-08-28','2002-11-23')))  and   cr_returned_date_sk   = d_date_sk  group by i_item_id),  wr_items as  (select i_item_id item_id,         sum(wr_return_quantity) wr_item_qty  from web_returns,       item,       date_dim  where wr_item_sk = i_item_sk  and   d_date    in  	(select d_date 	from date_dim 	where d_week_seq in  		(select d_week_seq 		from date_dim 		where d_date in ('2002-02-14','2002-08-28','2002-11-23')))  and   wr_returned_date_sk   = d_date_sk  group by i_item_id)   select  sr_items.item_id        ,sr_item_qty        ,sr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 sr_dev        ,cr_item_qty        ,cr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 cr_dev        ,wr_item_qty        ,wr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 wr_dev        ,(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 average  from sr_items      ,cr_items      ,wr_items  where sr_items.item_id=cr_items.item_id    and sr_items.item_id=wr_items.item_id   order by sr_items.item_id          ,sr_item_qty  limit 100;
q81#####with sr_items as  (select i_item_id item_id,         sum(sr_return_quantity) sr_item_qty  from store_returns,       item,       date_dim  where sr_item_sk = i_item_sk  and   d_date    in  	(select d_date 	from date_dim 	where d_week_seq in  		(select d_week_seq 		from date_dim 	  where d_date in ('2002-01-10','2002-08-27','2002-11-02')))  and   sr_returned_date_sk   = d_date_sk  group by i_item_id),  cr_items as  (select i_item_id item_id,         sum(cr_return_quantity) cr_item_qty  from catalog_returns,       item,       date_dim  where cr_item_sk = i_item_sk  and   d_date    in  	(select d_date 	from date_dim 	where d_week_seq in  		(select d_week_seq 		from date_dim 	  where d_date in ('2002-01-10','2002-08-27','2002-11-02')))  and   cr_returned_date_sk   = d_date_sk  group by i_item_id),  wr_items as  (select i_item_id item_id,         sum(wr_return_quantity) wr_item_qty  from web_returns,       item,       date_dim  where wr_item_sk = i_item_sk  and   d_date    in  	(select d_date 	from date_dim 	where d_week_seq in  		(select d_week_seq 		from date_dim 		where d_date in ('2002-01-10','2002-08-27','2002-11-02')))  and   wr_returned_date_sk   = d_date_sk  group by i_item_id)   select  sr_items.item_id        ,sr_item_qty        ,sr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 sr_dev        ,cr_item_qty        ,cr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 cr_dev        ,wr_item_qty        ,wr_item_qty/(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 * 100 wr_dev        ,(sr_item_qty+cr_item_qty+wr_item_qty)/3.0 average  from sr_items      ,cr_items      ,wr_items  where sr_items.item_id=cr_items.item_id    and sr_items.item_id=wr_items.item_id   order by sr_items.item_id          ,sr_item_qty  limit 100;
q82#####select  c_customer_id as customer_id        , concat(c_last_name, ',' , c_first_name) as customername  from customer      ,customer_address      ,customer_demographics      ,household_demographics      ,income_band      ,store_returns  where ca_city	        =  'Waterloo'    and c_current_addr_sk = ca_address_sk    and ib_lower_bound   >=  34290    and ib_upper_bound   <=  34290 + 50000    and ib_income_band_sk = hd_income_band_sk    and cd_demo_sk = c_current_cdemo_sk    and hd_demo_sk = c_current_hdemo_sk    and sr_cdemo_sk = cd_demo_sk  order by c_customer_id  limit 100;
q83#####select  c_customer_id as customer_id        , concat(c_last_name, ',' , c_first_name) as customername  from customer      ,customer_address      ,customer_demographics      ,household_demographics      ,income_band      ,store_returns  where ca_city	        =  'Ashland'    and c_current_addr_sk = ca_address_sk    and ib_lower_bound   >=  48324    and ib_upper_bound   <=  48324 + 50000    and ib_income_band_sk = hd_income_band_sk    and cd_demo_sk = c_current_cdemo_sk    and hd_demo_sk = c_current_hdemo_sk    and sr_cdemo_sk = cd_demo_sk  order by c_customer_id  limit 100;
q84#####select  substr(r_reason_desc,1,20)        ,avg(ws_quantity)        ,avg(wr_refunded_cash)        ,avg(wr_fee)  from web_sales, web_returns, web_page, customer_demographics cd1,       customer_demographics cd2, customer_address, date_dim, reason   where ws_web_page_sk = wp_web_page_sk    and ws_item_sk = wr_item_sk    and ws_order_number = wr_order_number    and ws_sold_date_sk = d_date_sk and d_year = 2002    and cd1.cd_demo_sk = wr_refunded_cdemo_sk     and cd2.cd_demo_sk = wr_returning_cdemo_sk    and ca_address_sk = wr_refunded_addr_sk    and r_reason_sk = wr_reason_sk    and    (     (      cd1.cd_marital_status = 'U'      and      cd1.cd_marital_status = cd2.cd_marital_status      and      cd1.cd_education_status = '4 yr Degree'      and       cd1.cd_education_status = cd2.cd_education_status      and      ws_sales_price between 100.00 and 150.00     )    or     (      cd1.cd_marital_status = 'M'      and      cd1.cd_marital_status = cd2.cd_marital_status      and      cd1.cd_education_status = 'College'       and      cd1.cd_education_status = cd2.cd_education_status      and      ws_sales_price between 50.00 and 100.00     )    or     (      cd1.cd_marital_status = 'W'      and      cd1.cd_marital_status = cd2.cd_marital_status      and      cd1.cd_education_status = 'Advanced Degree'      and      cd1.cd_education_status = cd2.cd_education_status      and      ws_sales_price between 150.00 and 200.00     )    )    and    (     (      ca_country = 'United States'      and      ca_state in ('OK', 'KY', 'IN')      and ws_net_profit between 100 and 200       )     or     (      ca_country = 'United States'      and      ca_state in ('WI', 'CO', 'MI')      and ws_net_profit between 150 and 300       )     or     (      ca_country = 'United States'      and      ca_state in ('SC', 'MO', 'ID')      and ws_net_profit between 50 and 250       )    ) group by r_reason_desc order by substr(r_reason_desc,1,20)         ,avg(ws_quantity)         ,avg(wr_refunded_cash)         ,avg(wr_fee) limit 100;
q85#####select  substr(r_reason_desc,1,20)        ,avg(ws_quantity)        ,avg(wr_refunded_cash)        ,avg(wr_fee)  from web_sales, web_returns, web_page, customer_demographics cd1,       customer_demographics cd2, customer_address, date_dim, reason   where ws_web_page_sk = wp_web_page_sk    and ws_item_sk = wr_item_sk    and ws_order_number = wr_order_number    and ws_sold_date_sk = d_date_sk and d_year = 2002    and cd1.cd_demo_sk = wr_refunded_cdemo_sk     and cd2.cd_demo_sk = wr_returning_cdemo_sk    and ca_address_sk = wr_refunded_addr_sk    and r_reason_sk = wr_reason_sk    and    (     (      cd1.cd_marital_status = 'M'      and      cd1.cd_marital_status = cd2.cd_marital_status      and      cd1.cd_education_status = 'Advanced Degree'      and       cd1.cd_education_status = cd2.cd_education_status      and      ws_sales_price between 100.00 and 150.00     )    or     (      cd1.cd_marital_status = 'D'      and      cd1.cd_marital_status = cd2.cd_marital_status      and      cd1.cd_education_status = 'Primary'       and      cd1.cd_education_status = cd2.cd_education_status      and      ws_sales_price between 50.00 and 100.00     )    or     (      cd1.cd_marital_status = 'U'      and      cd1.cd_marital_status = cd2.cd_marital_status      and      cd1.cd_education_status = '2 yr Degree'      and      cd1.cd_education_status = cd2.cd_education_status      and      ws_sales_price between 150.00 and 200.00     )    )    and    (     (      ca_country = 'United States'      and      ca_state in ('AR', 'IL', 'IA')      and ws_net_profit between 100 and 200       )     or     (      ca_country = 'United States'      and      ca_state in ('CO', 'KY', 'CA')      and ws_net_profit between 150 and 300       )     or     (      ca_country = 'United States'      and      ca_state in ('MN', 'MS', 'PA')      and ws_net_profit between 50 and 250       )    ) group by r_reason_desc order by substr(r_reason_desc,1,20)         ,avg(ws_quantity)         ,avg(wr_refunded_cash)         ,avg(wr_fee) limit 100;
q86#####select  * from( select i_category, i_class, i_brand,        s_store_name, s_company_name,        d_moy,        sum(ss_sales_price) sum_sales,        avg(sum(ss_sales_price)) over          (partition by i_category, i_brand, s_store_name, s_company_name)          avg_monthly_sales from item, store_sales, date_dim, store where ss_item_sk = i_item_sk and       ss_sold_date_sk = d_date_sk and       ss_store_sk = s_store_sk and       d_year in (2001) and         ((i_category in ('Sports','Books','Music') and           i_class in ('athletic shoes','romance','classical')          )       or (i_category in ('Women','Children','Jewelry') and           i_class in ('dresses','toddlers','mens watch')          )) group by i_category, i_class, i_brand,          s_store_name, s_company_name, d_moy) tmp1 where case when (avg_monthly_sales <> 0) then (abs(sum_sales - avg_monthly_sales) / avg_monthly_sales) else null end > 0.1 order by sum_sales - avg_monthly_sales, s_store_name limit 100;
q87#####select  * from( select i_category, i_class, i_brand,        s_store_name, s_company_name,        d_moy,        sum(ss_sales_price) sum_sales,        avg(sum(ss_sales_price)) over          (partition by i_category, i_brand, s_store_name, s_company_name)          avg_monthly_sales from item, store_sales, date_dim, store where ss_item_sk = i_item_sk and       ss_sold_date_sk = d_date_sk and       ss_store_sk = s_store_sk and       d_year in (2000) and         ((i_category in ('Women','Jewelry','Books') and           i_class in ('fragrances','pendants','travel')          )       or (i_category in ('Men','Shoes','Music') and           i_class in ('accessories','kids','country')          )) group by i_category, i_class, i_brand,          s_store_name, s_company_name, d_moy) tmp1 where case when (avg_monthly_sales <> 0) then (abs(sum_sales - avg_monthly_sales) / avg_monthly_sales) else null end > 0.1 order by sum_sales - avg_monthly_sales, s_store_name limit 100;
q88#####select  cast(amc as decimal(15,4))/cast(pmc as decimal(15,4)) am_pm_ratio  from ( select count(*) amc        from web_sales, household_demographics , time_dim, web_page        where ws_sold_time_sk = time_dim.t_time_sk          and ws_ship_hdemo_sk = household_demographics.hd_demo_sk          and ws_web_page_sk = web_page.wp_web_page_sk          and time_dim.t_hour between 7 and 7+1          and household_demographics.hd_dep_count = 7          and web_page.wp_char_count between 5000 and 5200) at,       ( select count(*) pmc        from web_sales, household_demographics , time_dim, web_page        where ws_sold_time_sk = time_dim.t_time_sk          and ws_ship_hdemo_sk = household_demographics.hd_demo_sk          and ws_web_page_sk = web_page.wp_web_page_sk          and time_dim.t_hour between 16 and 16+1          and household_demographics.hd_dep_count = 7          and web_page.wp_char_count between 5000 and 5200) pt  order by am_pm_ratio  limit 100;
q89#####select  cast(amc as decimal(15,4))/cast(pmc as decimal(15,4)) am_pm_ratio  from ( select count(*) amc        from web_sales, household_demographics , time_dim, web_page        where ws_sold_time_sk = time_dim.t_time_sk          and ws_ship_hdemo_sk = household_demographics.hd_demo_sk          and ws_web_page_sk = web_page.wp_web_page_sk          and time_dim.t_hour between 6 and 6+1          and household_demographics.hd_dep_count = 1          and web_page.wp_char_count between 5000 and 5200) at,       ( select count(*) pmc        from web_sales, household_demographics , time_dim, web_page        where ws_sold_time_sk = time_dim.t_time_sk          and ws_ship_hdemo_sk = household_demographics.hd_demo_sk          and ws_web_page_sk = web_page.wp_web_page_sk          and time_dim.t_hour between 18 and 18+1          and household_demographics.hd_dep_count = 1          and web_page.wp_char_count between 5000 and 5200) pt  order by am_pm_ratio  limit 100;
q90#####select      sum(ws_ext_discount_amt)  as Excess_Discount_Amount  from      web_sales     ,item     ,date_dim where i_manufact_id = 628 and i_item_sk = ws_item_sk  and d_date between '2002-03-31' and          (cast('2002-03-31' as date) + interval 90 days) and d_date_sk = ws_sold_date_sk  and ws_ext_discount_amt        > (           SELECT              1.3 * avg(ws_ext_discount_amt)           FROM              web_sales             ,date_dim          WHERE                ws_item_sk = i_item_sk            and d_date between '2002-03-31' and                              (cast('2002-03-31' as date) + interval 90 days)           and d_date_sk = ws_sold_date_sk        )  order by sum(ws_ext_discount_amt) limit 100;
q91#####select      sum(ws_ext_discount_amt)  as Excess_Discount_Amount  from      web_sales     ,item     ,date_dim where i_manufact_id = 52 and i_item_sk = ws_item_sk  and d_date between '2002-02-15' and          (cast('2002-02-15' as date) + interval 90 days) and d_date_sk = ws_sold_date_sk  and ws_ext_discount_amt        > (           SELECT              1.3 * avg(ws_ext_discount_amt)           FROM              web_sales             ,date_dim          WHERE                ws_item_sk = i_item_sk            and d_date between '2002-02-15' and                              (cast('2002-02-15' as date) + interval 90 days)           and d_date_sk = ws_sold_date_sk        )  order by sum(ws_ext_discount_amt) limit 100;
q92#####select      count(distinct ws_order_number) as order_count   ,sum(ws_ext_ship_cost) as total_shipping_cost   ,sum(ws_net_profit) as total_net_profit from    web_sales ws1   ,date_dim   ,customer_address   ,web_site where     d_date between '2001-5-01' and             (cast('2001-5-01' as date) + interval 60 days) and ws1.ws_ship_date_sk = d_date_sk and ws1.ws_ship_addr_sk = ca_address_sk and ca_state = 'PA' and ws1.ws_web_site_sk = web_site_sk and web_company_name = 'pri' and exists (select *             from web_sales ws2             where ws1.ws_order_number = ws2.ws_order_number               and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk) and not exists(select *                from web_returns wr1                where ws1.ws_order_number = wr1.wr_order_number) order by count(distinct ws_order_number) limit 100;
q93#####select      count(distinct ws_order_number) as order_count   ,sum(ws_ext_ship_cost) as total_shipping_cost   ,sum(ws_net_profit) as total_net_profit from    web_sales ws1   ,date_dim   ,customer_address   ,web_site where     d_date between '2002-3-01' and             (cast('2002-3-01' as date) + interval 60 days) and ws1.ws_ship_date_sk = d_date_sk and ws1.ws_ship_addr_sk = ca_address_sk and ca_state = 'IL' and ws1.ws_web_site_sk = web_site_sk and web_company_name = 'pri' and exists (select *             from web_sales ws2             where ws1.ws_order_number = ws2.ws_order_number               and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk) and not exists(select *                from web_returns wr1                where ws1.ws_order_number = wr1.wr_order_number) order by count(distinct ws_order_number) limit 100;
q94#####with ws_wh as (select ws1.ws_order_number,ws1.ws_warehouse_sk wh1,ws2.ws_warehouse_sk wh2  from web_sales ws1,web_sales ws2  where ws1.ws_order_number = ws2.ws_order_number    and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)  select      count(distinct ws_order_number) as order_count   ,sum(ws_ext_ship_cost) as total_shipping_cost   ,sum(ws_net_profit) as total_net_profit from    web_sales ws1   ,date_dim   ,customer_address   ,web_site where     d_date between '2001-5-01' and             (cast('2001-5-01' as date) + interval 60 days) and ws1.ws_ship_date_sk = d_date_sk and ws1.ws_ship_addr_sk = ca_address_sk and ca_state = 'PA' and ws1.ws_web_site_sk = web_site_sk and web_company_name = 'pri' and ws1.ws_order_number in (select ws_order_number                             from ws_wh) and ws1.ws_order_number in (select wr_order_number                             from web_returns,ws_wh                             where wr_order_number = ws_wh.ws_order_number) order by count(distinct ws_order_number) limit 100;
q95#####with ws_wh as (select ws1.ws_order_number,ws1.ws_warehouse_sk wh1,ws2.ws_warehouse_sk wh2  from web_sales ws1,web_sales ws2  where ws1.ws_order_number = ws2.ws_order_number    and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)  select      count(distinct ws_order_number) as order_count   ,sum(ws_ext_ship_cost) as total_shipping_cost   ,sum(ws_net_profit) as total_net_profit from    web_sales ws1   ,date_dim   ,customer_address   ,web_site where     d_date between '2002-3-01' and             (cast('2002-3-01' as date) + interval 60 days) and ws1.ws_ship_date_sk = d_date_sk and ws1.ws_ship_addr_sk = ca_address_sk and ca_state = 'IL' and ws1.ws_web_site_sk = web_site_sk and web_company_name = 'pri' and ws1.ws_order_number in (select ws_order_number                             from ws_wh) and ws1.ws_order_number in (select wr_order_number                             from web_returns,ws_wh                             where wr_order_number = ws_wh.ws_order_number) order by count(distinct ws_order_number) limit 100;
q96#####select i_item_id       ,i_item_desc        ,i_category        ,i_class        ,i_current_price       ,sum(ss_ext_sales_price) as itemrevenue        ,sum(ss_ext_sales_price)*100/sum(sum(ss_ext_sales_price)) over           (partition by i_class) as revenueratio from	 	store_sales     	,item      	,date_dim where  	ss_item_sk = i_item_sk    	and i_category in ('Home', 'Sports', 'Shoes')   	and ss_sold_date_sk = d_date_sk 	and d_date between cast('2000-02-16' as date)  				and (cast('2000-02-16' as date) + interval 30 days) group by  	i_item_id         ,i_item_desc          ,i_category         ,i_class         ,i_current_price order by  	i_category         ,i_class         ,i_item_id         ,i_item_desc         ,revenueratio;
q97#####select i_item_id       ,i_item_desc        ,i_category        ,i_class        ,i_current_price       ,sum(ss_ext_sales_price) as itemrevenue        ,sum(ss_ext_sales_price)*100/sum(sum(ss_ext_sales_price)) over           (partition by i_class) as revenueratio from	 	store_sales     	,item      	,date_dim where  	ss_item_sk = i_item_sk    	and i_category in ('Electronics', 'Music', 'Sports')   	and ss_sold_date_sk = d_date_sk 	and d_date between cast('2001-04-03' as date)  				and (cast('2001-04-03' as date) + interval 30 days) group by  	i_item_id         ,i_item_desc          ,i_category         ,i_class         ,i_current_price order by  	i_category         ,i_class         ,i_item_id         ,i_item_desc         ,revenueratio;
